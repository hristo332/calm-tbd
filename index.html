<!DOCTYPE html>
<html lang="bg">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>C.A.L.M. √ó TBD‚Ñ¢ Dashboard</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #FFF5EE; }
    #root { min-height: 100vh; }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
const { useState, useEffect, useCallback, useRef, useMemo } = React;

// ‚îÄ‚îÄ‚îÄ CONSTANTS ‚îÄ‚îÄ‚îÄ
const PHASES = [
  { id: 0, name: "–°—Ç–∞—Ä—Ç", badge: "üèÖ", badgeText: "–°–∏—Å—Ç–µ–º–∞—Ç–∞ —Ä–∞–±–æ—Ç–∏" },
  { id: 1, name: "–ò–¥–µ–∞–ª–µ–Ω –∫–ª–∏–µ–Ω—Ç", badge: "üèÖ", badgeText: "–ó–Ω–∞–µ—à –ö–û–ô" },
  { id: 2, name: "–û—Ñ–µ—Ä—Ç–∞", badge: "üèÖ", badgeText: "–û—Ñ–µ—Ä—Ç–∞—Ç–∞ –µ –Ω–µ—É—Å—Ç–æ–∏–º–∞" },
  { id: 3, name: "–ù–æ–≤–∏ –∫–ª–∏–µ–Ω—Ç–∏", badge: "üèÖ", badgeText: "–ö–ª–∏–µ–Ω—Ç–∏—Ç–µ –∏–¥–≤–∞—Ç" },
  { id: 4, name: "–°—ä–¥—ä—Ä–∂–∞–Ω–∏–µ", badge: "üèÖ", badgeText: "–°—ä–¥—ä—Ä–∂–∞–Ω–∏–µ—Ç–æ —Ä–∞–±–æ—Ç–∏" },
  { id: 5, name: "–ü—Ä–æ–¥–∞–∂–±–∏", badge: "üèÖ", badgeText: "–ü—Ä–æ–¥–∞–∂–±–∏—Ç–µ —Ç–µ–∫–∞—Ç" },
  { id: 6, name: "Delivery", badge: "üèÖ", badgeText: "Delivery –º–∞—à–∏–Ω–∞" },
  { id: 7, name: "–ò–∑–º–µ—Ä–≤–∞–Ω–µ", badge: "üèÖ", badgeText: "–ò–∑–º–µ—Ä–≤–∞—à –∫–∞—Ç–æ –ø—Ä–æ" },
];

const LEVELS = [
  { min: 0, emoji: "üå±", name: "–ù–∞—á–∏–Ω–∞–µ—â", color: "#8B9467" },
  { min: 2, emoji: "üåø", name: "–†–∞—Å—Ç—è—â", color: "#5B8C5A" },
  { min: 5, emoji: "üå≥", name: "–°—Ç–∞–±–∏–ª–µ–Ω", color: "#2D6A4F" },
  { min: 9, emoji: "üöÄ", name: "–ò–∑—Å—Ç—Ä–µ–ª—è–≤–∞—â —Å–µ", color: "#E76F51" },
  { min: 14, emoji: "üíé", name: "–î–∏–∞–º–∞–Ω—Ç", color: "#9B5DE5" },
];

const DAYS_BG = ["–ü–æ–Ω", "–í—Ç", "–°—Ä", "–ß–µ—Ç", "–ü–µ—Ç", "–°—ä–±", "–ù–µ–¥"];
const DAYS_BG_FULL = ["–ü–æ–Ω–µ–¥–µ–ª–Ω–∏–∫", "–í—Ç–æ—Ä–Ω–∏–∫", "–°—Ä—è–¥–∞", "–ß–µ—Ç–≤—ä—Ä—Ç—ä–∫", "–ü–µ—Ç—ä–∫", "–°—ä–±–æ—Ç–∞", "–ù–µ–¥–µ–ª—è"];
const MONTHS_BG = ["–Ø–Ω—É–∞—Ä–∏","–§–µ–≤—Ä—É–∞—Ä–∏","–ú–∞—Ä—Ç","–ê–ø—Ä–∏–ª","–ú–∞–π","–Æ–Ω–∏","–Æ–ª–∏","–ê–≤–≥—É—Å—Ç","–°–µ–ø—Ç–µ–º–≤—Ä–∏","–û–∫—Ç–æ–º–≤—Ä–∏","–ù–æ–µ–º–≤—Ä–∏","–î–µ–∫–µ–º–≤—Ä–∏"];

const REVENUE_MILESTONES = [1000, 2000, 3000, 4000, 5000];

// Hours per category (auto-calculated from task count)
const HOURS_PER = { deep: 2, quick: 0.5, learn: 1 };

// Phase-to-week mapping for 13-week journey
const PHASE_WEEKS = [
  { phase: 0, name: "–°—Ç–∞—Ä—Ç",    startWeek: 0, endWeek: 0, color: "#8B9467" },
  { phase: 1, name: "–ö–æ–π –µ –∫–ª–∏–µ–Ω—Ç—ä—Ç",   startWeek: 1, endWeek: 2, color: "#5B8C5A" },
  { phase: 2, name: "–û—Ñ–µ—Ä—Ç–∞",   startWeek: 3, endWeek: 4, color: "#2D6A4F" },
  { phase: 3, name: "–ö–ª–∏–µ–Ω—Ç–∏",  startWeek: 5, endWeek: 6, color: "#E76F51" },
  { phase: 4, name: "–°—ä–¥—ä—Ä–∂–∞–Ω–∏–µ", startWeek: 7, endWeek: 8, color: "#E8813A" },
  { phase: 5, name: "–ü—Ä–æ–¥–∞–∂–±–∏", startWeek: 9, endWeek: 10, color: "#D4A017" },
  { phase: 6, name: "Delivery", startWeek: 11, endWeek: 11, color: "#4A90D9" },
  { phase: 7, name: "–ò–∑–º–µ—Ä–≤–∞–Ω–µ", startWeek: 12, endWeek: 12, color: "#9B5DE5" },
];

// ‚îÄ‚îÄ‚îÄ COLORS ‚îÄ‚îÄ‚îÄ
const C = {
  bg: "#FFF5EE",
  bgCard: "#FFFFFF",
  deepWork: "#E8813A",
  deepWorkLight: "#FFF4EC",
  deepWorkBorder: "#F5DCC8",
  quickWin: "#5BBD72",
  quickWinLight: "#F0FAF2",
  quickWinBorder: "#C8E8CF",
  learn: "#4A90D9",
  learnLight: "#EDF4FC",
  learnBorder: "#C4D9F0",
  border: "#F0E6DE",
  textPrimary: "#1A1A1A",
  textSecondary: "#666666",
  textMuted: "#999999",
  gold: "#D4A017",
  goldLight: "#FFF8E7",
  blue: "#4A90D9",
  purple: "#7C4DFF",
  orange: "#E8813A",
  accent: "#E8813A",
  ritual: "#6C5CE7",
  ritualLight: "#F3F0FF",
  ritualBorder: "#D5CFF5",
};

// ‚îÄ‚îÄ‚îÄ AUDIO ENGINE ‚îÄ‚îÄ‚îÄ
const AudioEngine = {
  ctx: null,
  getCtx() {
    if (!this.ctx || this.ctx.state === "closed") {
      this.ctx = new (window.AudioContext || window.webkitAudioContext)();
    }
    if (this.ctx.state === "suspended") this.ctx.resume();
    return this.ctx;
  },
  playQuickWin() {
    const ctx = this.getCtx();
    const now = ctx.currentTime;
    [880, 1108, 1318].forEach((freq, i) => {
      const osc = ctx.createOscillator();
      const gain = ctx.createGain();
      osc.type = "sine";
      osc.frequency.setValueAtTime(freq, now + i * 0.08);
      gain.gain.setValueAtTime(0.25, now + i * 0.08);
      gain.gain.exponentialRampToValueAtTime(0.01, now + i * 0.08 + 0.3);
      osc.connect(gain).connect(ctx.destination);
      osc.start(now + i * 0.08);
      osc.stop(now + i * 0.08 + 0.35);
    });
  },
  playLearn() {
    const ctx = this.getCtx();
    const now = ctx.currentTime;
    [523, 587, 659, 784, 880].forEach((freq, i) => {
      const osc = ctx.createOscillator();
      const gain = ctx.createGain();
      osc.type = "triangle";
      osc.frequency.setValueAtTime(freq, now + i * 0.12);
      gain.gain.setValueAtTime(0.2, now + i * 0.12);
      gain.gain.exponentialRampToValueAtTime(0.01, now + i * 0.12 + 0.5);
      osc.connect(gain).connect(ctx.destination);
      osc.start(now + i * 0.12);
      osc.stop(now + i * 0.12 + 0.55);
    });
  },
  playDeepWork() {
    const ctx = this.getCtx();
    const now = ctx.currentTime;
    for (let i = 0; i < 8; i++) {
      const osc = ctx.createOscillator();
      const gain = ctx.createGain();
      osc.type = "square";
      osc.frequency.setValueAtTime(200 + i * 80, now + i * 0.06);
      gain.gain.setValueAtTime(0.08, now + i * 0.06);
      gain.gain.exponentialRampToValueAtTime(0.01, now + i * 0.06 + 0.08);
      osc.connect(gain).connect(ctx.destination);
      osc.start(now + i * 0.06);
      osc.stop(now + i * 0.06 + 0.1);
    }
    setTimeout(() => {
      [523, 659, 784, 1047, 784, 1047].forEach((freq, i) => {
        const osc = ctx.createOscillator();
        const gain = ctx.createGain();
        osc.type = "sine";
        osc.frequency.setValueAtTime(freq, ctx.currentTime + i * 0.12);
        gain.gain.setValueAtTime(0.2, ctx.currentTime + i * 0.12);
        gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + i * 0.12 + 0.25);
        osc.connect(gain).connect(ctx.destination);
        osc.start(ctx.currentTime + i * 0.12);
        osc.stop(ctx.currentTime + i * 0.12 + 0.3);
      });
    }, 550);
  },
  playLevelUp() {
    const ctx = this.getCtx();
    const now = ctx.currentTime;
    [262, 330, 392, 523, 659, 784, 1047].forEach((freq, i) => {
      const osc = ctx.createOscillator();
      const gain = ctx.createGain();
      osc.type = "sine";
      osc.frequency.setValueAtTime(freq, now + i * 0.1);
      gain.gain.setValueAtTime(0.18, now + i * 0.1);
      gain.gain.exponentialRampToValueAtTime(0.01, now + i * 0.1 + 0.5);
      osc.connect(gain).connect(ctx.destination);
      osc.start(now + i * 0.1);
      osc.stop(now + i * 0.1 + 0.55);
    });
    setTimeout(() => {
      [1047, 1318, 1568].forEach(freq => {
        const osc = ctx.createOscillator();
        const gain = ctx.createGain();
        osc.type = "sine";
        osc.frequency.setValueAtTime(freq, ctx.currentTime);
        gain.gain.setValueAtTime(0.18, ctx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 1.5);
        osc.connect(gain).connect(ctx.destination);
        osc.start();
        osc.stop(ctx.currentTime + 1.6);
      });
    }, 800);
  },
  playRevenue() {
    const ctx = this.getCtx();
    const now = ctx.currentTime;
    const osc = ctx.createOscillator();
    const gain = ctx.createGain();
    osc.type = "square";
    osc.frequency.setValueAtTime(800, now);
    osc.frequency.setValueAtTime(1200, now + 0.05);
    gain.gain.setValueAtTime(0.12, now);
    gain.gain.exponentialRampToValueAtTime(0.01, now + 0.2);
    osc.connect(gain).connect(ctx.destination);
    osc.start(now);
    osc.stop(now + 0.25);
  },
  // Ritual complete ‚Äî epic triumphant sound
  playRitualComplete() {
    const ctx = this.getCtx();
    const now = ctx.currentTime;
    // Deep warm chord
    [261, 329, 392, 523].forEach((freq, i) => {
      const osc = ctx.createOscillator();
      const gain = ctx.createGain();
      osc.type = "sine";
      osc.frequency.setValueAtTime(freq, now);
      gain.gain.setValueAtTime(0.15, now);
      gain.gain.exponentialRampToValueAtTime(0.01, now + 1.5);
      osc.connect(gain).connect(ctx.destination);
      osc.start(now + i * 0.05);
      osc.stop(now + 1.6);
    });
    // Rising sparkle
    setTimeout(() => {
      [784, 880, 1047, 1318, 1568, 1760].forEach((freq, i) => {
        const osc = ctx.createOscillator();
        const gain = ctx.createGain();
        osc.type = "sine";
        osc.frequency.setValueAtTime(freq, ctx.currentTime + i * 0.08);
        gain.gain.setValueAtTime(0.12, ctx.currentTime + i * 0.08);
        gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + i * 0.08 + 0.6);
        osc.connect(gain).connect(ctx.destination);
        osc.start(ctx.currentTime + i * 0.08);
        osc.stop(ctx.currentTime + i * 0.08 + 0.65);
      });
    }, 400);
    // Final sparkle dust
    setTimeout(() => {
      for (let i = 0; i < 15; i++) {
        setTimeout(() => {
          const osc = ctx.createOscillator();
          const gain = ctx.createGain();
          osc.type = "sine";
          osc.frequency.setValueAtTime(2000 + Math.random() * 3000, ctx.currentTime);
          gain.gain.setValueAtTime(0.04, ctx.currentTime);
          gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.08);
          osc.connect(gain).connect(ctx.destination);
          osc.start();
          osc.stop(ctx.currentTime + 0.1);
        }, i * 40);
      }
    }, 900);
  },
  playBreathBell() {
    const ctx = this.getCtx();
    const now = ctx.currentTime;
    const osc = ctx.createOscillator();
    const gain = ctx.createGain();
    osc.type = "sine";
    osc.frequency.setValueAtTime(528, now);
    gain.gain.setValueAtTime(0.15, now);
    gain.gain.exponentialRampToValueAtTime(0.001, now + 1.2);
    osc.connect(gain).connect(ctx.destination);
    osc.start(now);
    osc.stop(now + 1.3);
  },
  _breathNode: null,
  _breathGain: null,
  startBreathSound(type) {
    const ctx = this.getCtx();
    this.stopBreathSound();
    const bufferSize = 2 * ctx.sampleRate;
    const noiseBuffer = ctx.createBuffer(1, bufferSize, ctx.sampleRate);
    const output = noiseBuffer.getChannelData(0);
    for (let i = 0; i < bufferSize; i++) output[i] = Math.random() * 2 - 1;
    const noise = ctx.createBufferSource();
    noise.buffer = noiseBuffer;
    noise.loop = true;
    const filter = ctx.createBiquadFilter();
    filter.type = "bandpass";
    filter.frequency.setValueAtTime(type === "inhale" ? 800 : 500, ctx.currentTime);
    filter.Q.setValueAtTime(0.8, ctx.currentTime);
    const gain = ctx.createGain();
    const now = ctx.currentTime;
    if (type === "inhale") {
      gain.gain.setValueAtTime(0.0, now);
      gain.gain.linearRampToValueAtTime(0.06, now + 2);
      gain.gain.linearRampToValueAtTime(0.04, now + 4);
    } else {
      gain.gain.setValueAtTime(0.06, now);
      gain.gain.linearRampToValueAtTime(0.02, now + 3);
      gain.gain.linearRampToValueAtTime(0.0, now + 4);
    }
    noise.connect(filter).connect(gain).connect(ctx.destination);
    noise.start();
    this._breathNode = noise;
    this._breathGain = gain;
  },
  stopBreathSound() {
    try { if (this._breathNode) { this._breathNode.stop(); this._breathNode.disconnect(); } } catch {}
    this._breathNode = null;
    this._breathGain = null;
  }
};

// ‚îÄ‚îÄ‚îÄ CONFETTI HOOK ‚îÄ‚îÄ‚îÄ
function useConfetti() {
  const [particles, setParticles] = useState([]);
  const animRef = useRef(null);
  const pRef = useRef([]);
  const launch = useCallback((intensity = "medium") => {
    const count = intensity === "small" ? 25 : intensity === "medium" ? 50 : 100;
    const colors = ["#D4A017", "#E8813A", "#5BBD72", "#4A90D9", "#9B5DE5", "#F7B731", "#FC5C65", "#45AAF2"];
    const np = Array.from({ length: count }, (_, i) => ({
      id: Date.now() + i + Math.random(),
      x: window.innerWidth / 2 + (Math.random() - 0.5) * 200,
      y: window.innerHeight * 0.4,
      vx: (Math.random() - 0.5) * (intensity === "big" ? 22 : 14),
      vy: -Math.random() * (intensity === "big" ? 22 : 16) - 5,
      color: colors[Math.floor(Math.random() * colors.length)],
      size: Math.random() * 7 + 3,
      rotation: Math.random() * 360,
      rs: (Math.random() - 0.5) * 14,
      opacity: 1,
      shape: Math.random() > 0.4 ? "rect" : "circle",
    }));
    pRef.current = [...pRef.current, ...np];
    setParticles([...pRef.current]);
    if (!animRef.current) {
      const anim = () => {
        pRef.current = pRef.current
          .map(p => ({ ...p, x: p.x + p.vx, y: p.y + p.vy, vy: p.vy + 0.4, vx: p.vx * 0.99, rotation: p.rotation + p.rs, opacity: p.opacity - 0.009 }))
          .filter(p => p.opacity > 0 && p.y < window.innerHeight + 50);
        setParticles([...pRef.current]);
        if (pRef.current.length > 0) animRef.current = requestAnimationFrame(anim);
        else animRef.current = null;
      };
      animRef.current = requestAnimationFrame(anim);
    }
  }, []);
  return { particles, launch };
}

// ‚îÄ‚îÄ‚îÄ HELPERS ‚îÄ‚îÄ‚îÄ
function getWeekRange(date) {
  const d = new Date(date);
  const day = d.getDay();
  const diff = d.getDate() - day + (day === 0 ? -6 : 1);
  const mon = new Date(d.setDate(diff));
  mon.setHours(0, 0, 0, 0);
  const sun = new Date(mon);
  sun.setDate(mon.getDate() + 6);
  return { start: mon, end: sun };
}
function formatDate(d) {
  return `${String(d.getDate()).padStart(2, "0")}.${String(d.getMonth() + 1).padStart(2, "0")}`;
}
function weekKey(date) {
  const { start } = getWeekRange(date);
  return `${start.getFullYear()}-W${String(start.getMonth() + 1).padStart(2, "0")}-${String(start.getDate()).padStart(2, "0")}`;
}
function getLevel(dw) {
  let level = LEVELS[0];
  for (const l of LEVELS) { if (dw >= l.min) level = l; }
  return level;
}

// ‚îÄ‚îÄ‚îÄ DONUT CHART ‚îÄ‚îÄ‚îÄ
function DonutChart({ deepHours, quickHours, learnHours, size = 180, viewMode = "week" }) {
  const total = deepHours + quickHours + learnHours;
  const sw = Math.max(12, size * 0.14);
  const r = size / 2 - sw / 2 - 4;
  const cx = size / 2;
  const cy = size / 2;
  const circumference = 2 * Math.PI * r;
  const mainFontSize = Math.max(14, size * 0.17);
  const subFontSize = Math.max(9, size * 0.075);

  if (total === 0) {
    return (
      <svg width={size} height={size} viewBox={`0 0 ${size} ${size}`}>
        <circle cx={cx} cy={cy} r={r} fill="none" stroke="#F0E6DE" strokeWidth={sw} />
        <text x={cx} y={cy - 4} textAnchor="middle" fill="#999" fontSize={subFontSize} fontFamily="system-ui">–ù—è–º–∞ –¥–∞–Ω–Ω–∏</text>
        <text x={cx} y={cy + 12} textAnchor="middle" fill="#CCC" fontSize={subFontSize * 0.85} fontFamily="system-ui">{viewMode === "journey" ? "–∑–∞ 90 –¥–Ω–∏" : "–∑–∞ —Ç–∞–∑–∏ —Å–µ–¥–º–∏—Ü–∞"}</text>
      </svg>
    );
  }

  const segments = [
    { value: deepHours, color: C.deepWork },
    { value: quickHours, color: C.quickWin },
    { value: learnHours, color: C.learn },
  ].filter(s => s.value > 0);

  let offset = circumference * 0.25;
  const gap = segments.length > 1 ? 3 : 0;

  return (
    <svg width={size} height={size} viewBox={`0 0 ${size} ${size}`}>
      <circle cx={cx} cy={cy} r={r} fill="none" stroke="#F5EFEA" strokeWidth={sw} />
      {segments.map((seg, i) => {
        const len = circumference * (seg.value / total);
        const el = (
          <circle key={i} cx={cx} cy={cy} r={r} fill="none"
            stroke={seg.color} strokeWidth={sw}
            strokeDasharray={`${len - gap} ${circumference - len + gap}`}
            strokeDashoffset={offset}
            strokeLinecap="round"
            style={{ transition: "stroke-dasharray 0.8s ease" }}
          />
        );
        offset -= len;
        return el;
      })}
      <text x={cx} y={cy - 2} textAnchor="middle" fill={C.textPrimary} fontSize={mainFontSize} fontWeight="800" fontFamily="system-ui">
        {total.toFixed(1)}—á
      </text>
      <text x={cx} y={cy + mainFontSize * 0.7} textAnchor="middle" fill={C.textMuted} fontSize={subFontSize} fontFamily="system-ui">
        {viewMode === "journey" ? "90 –¥–Ω–∏" : "—Ç–∞–∑–∏ —Å–µ–¥–º–∏—Ü–∞"}
      </text>
    </svg>
  );
}

// ‚îÄ‚îÄ‚îÄ BAR CHART (13-week 90-day journey) ‚îÄ‚îÄ‚îÄ
function BarChart({ weeklyData, dayNumber }) {
  const maxH = Math.max(...weeklyData.map(d => d.deep + d.quick + d.learn), 1);
  const chartH = 220;
  const gridLines = 4;
  const maxLabel = Math.ceil(maxH);
  const completedWeeks = weeklyData.filter(d => d.deep + d.quick + d.learn > 0).length;

  // Build phase info per bar index
  const getPhase = (idx) => PHASE_WEEKS.find(p => idx >= p.startWeek && idx <= p.endWeek);

  // Check if this bar is first in its phase (for left border)
  const isPhaseStart = (idx) => PHASE_WEEKS.some(p => p.startWeek === idx);
  // Check if this bar is last in its phase (for showing label)
  const isPhaseEnd = (idx) => PHASE_WEEKS.some(p => p.endWeek === idx);

  return (
    <div style={{ display: "flex", flexDirection: "column", width: "100%" }}>
      {/* Header */}
      <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 6 }}>
        <div style={{ display: "flex", alignItems: "center", gap: 8 }}>
          <span style={{ fontSize: 15 }}>üìä</span>
          <span style={{ fontSize: 14, fontWeight: 800, color: C.textPrimary }}>90-–¥–Ω–µ–≤–µ–Ω –Ω–∞–ø—Ä–µ–¥—ä–∫</span>
        </div>
        <div style={{ display: "flex", gap: 12 }}>
          {[
            { color: C.deepWork, label: "Deep Work" },
            { color: C.quickWin, label: "Quick Wins" },
            { color: C.learn, label: "Learn" },
          ].map(l => (
            <div key={l.label} style={{ display: "flex", alignItems: "center", gap: 4 }}>
              <div style={{ width: 8, height: 8, borderRadius: 2, background: l.color }} />
              <span style={{ fontSize: 10, color: C.textMuted }}>{l.label}</span>
            </div>
          ))}
        </div>
      </div>

      {/* 90-day progress bar */}
      <div style={{ marginBottom: 14 }}>
        <div style={{ display: "flex", alignItems: "center", gap: 10, marginBottom: 4 }}>
          <div style={{ flex: 1, height: 8, background: "#F0E6DE", borderRadius: 4, overflow: "hidden", position: "relative" }}>
            <div style={{
              height: "100%", borderRadius: 4,
              background: `linear-gradient(90deg, ${C.accent}, ${C.orange}CC)`,
              width: `${Math.min(100, (dayNumber / 90) * 100)}%`,
              transition: "width 1s ease",
              boxShadow: `0 1px 4px ${C.accent}33`,
            }} />
            {/* Phase zone markers on progress bar */}
            {PHASE_WEEKS.slice(1).map(p => (
              <div key={p.phase} style={{
                position: "absolute", top: 0, bottom: 0,
                left: `${(p.startWeek / 13) * 100}%`,
                width: 1.5, background: "rgba(255,255,255,0.7)",
              }} />
            ))}
          </div>
          <span style={{ fontSize: 11, fontWeight: 700, color: C.accent, whiteSpace: "nowrap" }}>
            –î–µ–Ω {dayNumber}/90
          </span>
        </div>
        <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center" }}>
          <span style={{ fontSize: 10, color: C.textMuted }}>üèÅ –°—Ç–∞—Ä—Ç</span>
          <span style={{ fontSize: 10, color: C.textMuted }}>{completedWeeks}/13 —Å–µ–¥–º–∏—Ü–∏ –∑–∞—Ç–≤–æ—Ä–µ–Ω–∏</span>
          <span style={{ fontSize: 10, color: C.textMuted }}>üèÜ –§–∏–Ω–∞–ª</span>
        </div>
      </div>

      {/* Chart with phase zones */}
      <div style={{ position: "relative", height: chartH + 58, display: "flex" }}>
        {/* Y-axis labels */}
        <div style={{ width: 30, height: chartH, position: "relative", flexShrink: 0 }}>
          {Array.from({ length: gridLines + 1 }, (_, i) => {
            const val = (maxLabel / gridLines) * (gridLines - i);
            return (
              <div key={i} style={{
                position: "absolute", top: `${(i / gridLines) * 100}%`,
                right: 4, transform: "translateY(-50%)",
                fontSize: 9, color: C.textMuted, fontWeight: 500,
              }}>
                {val.toFixed(val % 1 === 0 ? 0 : 1)}—á
              </div>
            );
          })}
        </div>

        <div style={{ flex: 1, position: "relative" }}>
          {/* Grid lines */}
          <div style={{ position: "absolute", top: 0, left: 0, right: 0, height: chartH }}>
            {Array.from({ length: gridLines + 1 }, (_, i) => (
              <div key={i} style={{
                position: "absolute", top: `${(i / gridLines) * 100}%`,
                left: 0, right: 0, height: 1,
                background: i === gridLines ? C.border : `${C.border}80`,
              }} />
            ))}
          </div>

          {/* Phase zone backgrounds (behind bars) */}
          <div style={{ position: "absolute", top: 0, left: 0, right: 0, height: chartH, display: "flex", zIndex: 0 }}>
            {weeklyData.map((_, i) => {
              const phase = getPhase(i);
              const isStart = isPhaseStart(i);
              return (
                <div key={i} style={{
                  flex: 1,
                  background: phase ? `${phase.color}06` : "transparent",
                  borderLeft: isStart && i > 0 ? `1.5px dashed ${phase?.color || "#DDD"}44` : "none",
                }} />
              );
            })}
          </div>

          {/* Bars */}
          <div style={{ display: "flex", height: chartH, position: "relative", zIndex: 1 }}>
            {weeklyData.map((d, i) => {
              const tot = d.deep + d.quick + d.learn;
              const totalH = maxLabel > 0 ? (tot / maxLabel) * chartH : 0;
              const deepH = tot > 0 ? (d.deep / tot) * totalH : 0;
              const quickH = tot > 0 ? (d.quick / tot) * totalH : 0;
              const learnH = tot > 0 ? (d.learn / tot) * totalH : 0;
              return (
                <div key={i} style={{
                  flex: 1, display: "flex", flexDirection: "column", alignItems: "center",
                  justifyContent: "flex-end", padding: "0 2px",
                  background: d.isCurrent ? `${C.accent}10` : "transparent",
                  borderRadius: "6px 6px 0 0",
                  opacity: d.isFuture ? 0.35 : 1,
                }}>
                  {tot > 0 && (
                    <div style={{
                      fontSize: 9, fontWeight: 700, color: C.textSecondary,
                      marginBottom: 3, padding: "1px 4px", borderRadius: 3,
                      background: d.isCurrent ? `${C.accent}15` : "#F5F5F5",
                    }}>
                      {tot.toFixed(1)}
                    </div>
                  )}
                  <div style={{
                    display: "flex", flexDirection: "column", width: "100%", maxWidth: 36,
                    borderRadius: "4px 4px 2px 2px", overflow: "hidden",
                    boxShadow: tot > 0 ? "0 2px 4px rgba(0,0,0,0.06)" : "none",
                    transition: "all 0.5s ease",
                  }}>
                    {learnH > 0 && <div style={{ height: learnH, background: `linear-gradient(180deg, ${C.learn}, ${C.learn}CC)`, transition: "height 0.5s ease" }} />}
                    {quickH > 0 && <div style={{ height: quickH, background: `linear-gradient(180deg, ${C.quickWin}, ${C.quickWin}CC)`, transition: "height 0.5s ease" }} />}
                    {deepH > 0 && <div style={{ height: deepH, background: `linear-gradient(180deg, ${C.deepWork}, ${C.deepWork}CC)`, transition: "height 0.5s ease" }} />}
                    {tot === 0 && !d.isFuture && <div style={{ height: 3, background: "#E8E0D8", borderRadius: 2 }} />}
                    {d.isFuture && <div style={{ height: 3, background: "#E8E0D855", borderRadius: 2, borderTop: "1px dashed #DDD" }} />}
                  </div>
                </div>
              );
            })}
          </div>

          {/* Week labels row */}
          <div style={{ display: "flex", marginTop: 4 }}>
            {weeklyData.map((d, i) => (
              <div key={i} style={{
                flex: 1, textAlign: "center",
                fontSize: 9, fontWeight: d.isCurrent ? 800 : 500,
                color: d.isCurrent ? C.accent : d.isFuture ? "#CCC" : C.textMuted,
                lineHeight: 1.3,
              }}>
                <div>{d.label}</div>
                {d.isCurrent && <div style={{ width: 4, height: 4, borderRadius: "50%", background: C.accent, margin: "2px auto 0" }} />}
              </div>
            ))}
          </div>

          {/* Phase labels row ‚Äî grouped spans */}
          <div style={{ display: "flex", marginTop: 2 }}>
            {PHASE_WEEKS.map(p => {
              const span = p.endWeek - p.startWeek + 1;
              return (
                <div key={p.phase} style={{
                  flex: span,
                  textAlign: "center",
                  padding: "3px 0 0",
                  borderTop: `2px solid ${p.color}55`,
                  position: "relative",
                }}>
                  <span style={{
                    fontSize: 8, fontWeight: 700, color: p.color,
                    textTransform: "uppercase", letterSpacing: 0.3,
                    whiteSpace: "nowrap", overflow: "hidden", textOverflow: "ellipsis",
                    display: "block", padding: "0 1px",
                  }}>
                    {p.name}
                  </span>
                </div>
              );
            })}
          </div>
        </div>
      </div>
    </div>
  );
}

// ‚îÄ‚îÄ‚îÄ BOX BREATHING ‚îÄ‚îÄ‚îÄ
function BoxBreathing() {
  const [active, setActive] = useState(false);
  const [phase, setPhase] = useState(0);
  const [count, setCount] = useState(4);
  const [cycle, setCycle] = useState(0);
  const intervalRef = useRef(null);
  const phaseRef = useRef(0);
  const countRef = useRef(4);
  const cycleRef = useRef(0);

  const PHASE_LABELS = ["–í–¥–∏—à–∞–π...", "–ó–∞–¥—Ä—ä–∂...", "–ò–∑–¥–∏—à–∞–π...", "–ó–∞–¥—Ä—ä–∂..."];

  const stop = useCallback(() => {
    if (intervalRef.current) clearInterval(intervalRef.current);
    intervalRef.current = null;
    setActive(false);
    setPhase(0);
    setCount(4);
    setCycle(0);
    phaseRef.current = 0;
    countRef.current = 4;
    cycleRef.current = 0;
    AudioEngine.stopBreathSound();
  }, []);

  const start = useCallback(() => {
    setActive(true);
    phaseRef.current = 0;
    countRef.current = 4;
    cycleRef.current = 0;
    setPhase(0);
    setCount(4);
    setCycle(0);
    AudioEngine.playBreathBell();
    AudioEngine.startBreathSound("inhale");

    intervalRef.current = setInterval(() => {
      countRef.current -= 1;
      if (countRef.current <= 0) {
        phaseRef.current = (phaseRef.current + 1) % 4;
        countRef.current = 4;
        if (phaseRef.current === 0) {
          cycleRef.current += 1;
          if (cycleRef.current >= 4) { stop(); return; }
          AudioEngine.playBreathBell();
          AudioEngine.startBreathSound("inhale");
        } else if (phaseRef.current === 2) {
          AudioEngine.startBreathSound("exhale");
        } else {
          AudioEngine.stopBreathSound();
        }
      }
      setPhase(phaseRef.current);
      setCount(countRef.current);
      setCycle(cycleRef.current);
    }, 1000);
  }, [stop]);

  useEffect(() => { return () => { if (intervalRef.current) clearInterval(intervalRef.current); AudioEngine.stopBreathSound(); }; }, []);

  const progress = (4 - count) / 4;
  const lungScale = active
    ? phase === 0 ? 0.7 + 0.3 * progress
    : phase === 1 ? 1.0
    : phase === 2 ? 1.0 - 0.3 * progress
    : 0.7
    : 0.85;
  const circleScale = active
    ? phase === 0 ? 0.85 + 0.15 * progress
    : phase === 1 ? 1.0
    : phase === 2 ? 1.0 - 0.15 * progress
    : 0.85
    : 0.92;
  const breathColor = active ? "#5BA8D9" : "#A8D0E8";
  const breathBg = active
    ? phase === 0 ? `rgba(91,168,217,${0.08 + 0.12 * progress})`
    : phase === 1 ? "rgba(91,168,217,0.20)"
    : phase === 2 ? `rgba(91,168,217,${0.20 - 0.12 * progress})`
    : "rgba(91,168,217,0.08)"
    : "rgba(91,168,217,0.06)";

  return (
    <div style={{
      background: C.bgCard, borderRadius: 16, padding: 16, border: `1px solid ${C.border}`,
      display: "flex", flexDirection: "column", alignItems: "center", justifyContent: "center",
      minHeight: 200, cursor: active ? "default" : "pointer",
    }} onClick={!active ? start : undefined}>
      <div style={{ fontSize: 13, fontWeight: 700, color: C.textPrimary, marginBottom: 10 }}>Box Breathing</div>
      <div style={{ position: "relative", width: 120, height: 120, marginBottom: 8 }}>
        <div style={{
          position: "absolute", top: "50%", left: "50%",
          width: 110, height: 110,
          transform: `translate(-50%, -50%) scale(${circleScale})`,
          transition: "transform 0.9s ease-in-out, background 0.5s, border-color 0.5s",
          borderRadius: "50%", background: breathBg, border: `2.5px solid ${breathColor}`,
        }} />
        <div style={{
          position: "absolute", top: "50%", left: "50%",
          transform: `translate(-50%, -44%) scale(${lungScale})`,
          transition: "transform 0.9s ease-in-out", width: 50, height: 56,
        }}>
          <svg viewBox="0 0 50 56" width="50" height="56" fill="none">
            <path d="M 25 2 L 25 18" stroke={breathColor} strokeWidth="2.5" strokeLinecap="round" />
            <path d="M 25 18 Q 22 22, 18 24" stroke={breathColor} strokeWidth="2" strokeLinecap="round" />
            <path d="M 25 18 Q 28 22, 32 24" stroke={breathColor} strokeWidth="2" strokeLinecap="round" />
            <path d="M 18 24 Q 8 26, 6 36 Q 4 46, 14 50 Q 20 52, 23 44 Q 24 38, 23 30 Q 22 26, 18 24 Z" fill={breathColor} opacity="0.2" stroke={breathColor} strokeWidth="1.5" />
            <path d="M 32 24 Q 42 26, 44 36 Q 46 46, 36 50 Q 30 52, 27 44 Q 26 38, 27 30 Q 28 26, 32 24 Z" fill={breathColor} opacity="0.2" stroke={breathColor} strokeWidth="1.5" />
          </svg>
        </div>
        {active && (
          <div style={{
            position: "absolute", top: 12, left: "50%", transform: "translateX(-50%)",
            fontSize: 20, fontWeight: 900, color: breathColor,
            textShadow: "0 0 8px rgba(255,255,255,0.9)", lineHeight: 1, zIndex: 2,
          }}>{count}</div>
        )}
      </div>
      {active ? (
        <>
          <div style={{ fontSize: 14, fontWeight: 700, color: breathColor, marginBottom: 4 }}>{PHASE_LABELS[phase]}</div>
          <div style={{ display: "flex", gap: 5, marginBottom: 8 }}>
            {[0, 1, 2, 3].map(i => (
              <div key={i} style={{ width: 7, height: 7, borderRadius: "50%", background: i < cycle ? C.quickWin : i === cycle ? breathColor : "#E0D5CA", transition: "background 0.3s" }} />
            ))}
          </div>
          <button onClick={(e) => { e.stopPropagation(); stop(); }}
            style={{ padding: "5px 18px", borderRadius: 20, border: "none", background: "#F5E6E6", color: "#C44", fontSize: 11, fontWeight: 700, cursor: "pointer" }}>
            –°—Ç–æ–ø
          </button>
        </>
      ) : (
        <>
          <div style={{ fontSize: 12, color: C.textMuted, marginBottom: 2 }}>–ö–ª–∏–∫–Ω–∏ –∑–∞ —Å—Ç–∞—Ä—Ç</div>
          <div style={{ fontSize: 20, fontWeight: 800, color: breathColor }}>4-4-4-4</div>
        </>
      )}
    </div>
  );
}

// ‚îÄ‚îÄ‚îÄ POMODORO TIMER (Full-width hero) ‚îÄ‚îÄ‚îÄ
function PomodoroTimer() {
  const [mode, setMode] = useState(null); // null | "deep" | "quick" | "learn"
  const [running, setRunning] = useState(false);
  const [secondsLeft, setSecondsLeft] = useState(0);
  const [totalSeconds, setTotalSeconds] = useState(0);
  const intervalRef = useRef(null);
  const endTimeRef = useRef(null);

  const MODES = {
    deep:  { duration: 120 * 60, label: "Deep Work",   emoji: "üèîÔ∏è", color: C.deepWork, lightBg: C.deepWorkLight, borderColor: C.deepWorkBorder, mins: "2 —á–∞—Å–∞" },
    quick: { duration: 30 * 60,  label: "Quick Win",   emoji: "‚ö°",  color: C.quickWin, lightBg: C.quickWinLight, borderColor: C.quickWinBorder, mins: "30 –º–∏–Ω" },
    learn: { duration: 60 * 60,  label: "Learn",       emoji: "üìö",  color: C.learn,    lightBg: C.learnLight,    borderColor: C.learnBorder, mins: "1 —á–∞—Å" },
  };

  const formatTime = (s) => {
    const h = Math.floor(s / 3600);
    const m = Math.floor((s % 3600) / 60);
    const sec = s % 60;
    if (h > 0) return `${h}:${String(m).padStart(2, "0")}:${String(sec).padStart(2, "0")}`;
    return `${String(m).padStart(2, "0")}:${String(sec).padStart(2, "0")}`;
  };

  const playStartSound = () => {
    try {
      const ctx = AudioEngine.getCtx();
      const now = ctx.currentTime;
      [440, 554, 659].forEach((freq, i) => {
        const osc = ctx.createOscillator();
        const gain = ctx.createGain();
        osc.type = "sine";
        osc.frequency.setValueAtTime(freq, now + i * 0.1);
        gain.gain.setValueAtTime(0.2, now + i * 0.1);
        gain.gain.exponentialRampToValueAtTime(0.01, now + i * 0.1 + 0.3);
        osc.connect(gain).connect(ctx.destination);
        osc.start(now + i * 0.1);
        osc.stop(now + i * 0.1 + 0.35);
      });
    } catch {}
  };

  const playEndSound = () => {
    try {
      const ctx = AudioEngine.getCtx();
      const now = ctx.currentTime;
      [784, 988, 1175, 1568].forEach((freq, i) => {
        const osc = ctx.createOscillator();
        const gain = ctx.createGain();
        osc.type = "sine";
        osc.frequency.setValueAtTime(freq, now + i * 0.15);
        gain.gain.setValueAtTime(0.25, now + i * 0.15);
        gain.gain.exponentialRampToValueAtTime(0.01, now + i * 0.15 + 0.8);
        osc.connect(gain).connect(ctx.destination);
        osc.start(now + i * 0.15);
        osc.stop(now + i * 0.15 + 0.85);
      });
      setTimeout(() => {
        const osc = ctx.createOscillator();
        const gain = ctx.createGain();
        osc.type = "sine";
        osc.frequency.setValueAtTime(523, ctx.currentTime);
        gain.gain.setValueAtTime(0.15, ctx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 2);
        osc.connect(gain).connect(ctx.destination);
        osc.start();
        osc.stop(ctx.currentTime + 2.1);
      }, 700);
    } catch {}
  };

  const startTimer = (m) => {
    setMode(m);
    const dur = MODES[m].duration;
    setTotalSeconds(dur);
    setSecondsLeft(dur);
    setRunning(true);
    endTimeRef.current = Date.now() + dur * 1000;
    playStartSound();
    if ("Notification" in window && Notification.permission === "default") Notification.requestPermission();
  };

  const stopTimer = () => {
    if (intervalRef.current) clearInterval(intervalRef.current);
    intervalRef.current = null;
    setRunning(false); setMode(null); setSecondsLeft(0);
    document.title = "C.A.L.M. Dashboard";
  };

  const pauseTimer = () => {
    if (intervalRef.current) clearInterval(intervalRef.current);
    intervalRef.current = null;
    setRunning(false);
  };

  const resumeTimer = () => {
    if (secondsLeft <= 0 || !mode) return;
    setRunning(true);
    endTimeRef.current = Date.now() + secondsLeft * 1000;
    playStartSound();
  };

  useEffect(() => {
    if (!running || !mode) return;
    intervalRef.current = setInterval(() => {
      const remaining = Math.max(0, Math.round((endTimeRef.current - Date.now()) / 1000));
      setSecondsLeft(remaining);
      if (remaining > 0 && remaining % 60 === 0 && remaining < totalSeconds) {
        try {
          const ctx = AudioEngine.getCtx();
          const osc = ctx.createOscillator();
          const gain = ctx.createGain();
          osc.type = "sine"; osc.frequency.setValueAtTime(880, ctx.currentTime);
          gain.gain.setValueAtTime(0.03, ctx.currentTime);
          gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.05);
          osc.connect(gain).connect(ctx.destination); osc.start(); osc.stop(ctx.currentTime + 0.06);
        } catch {}
      }
      if (remaining <= 0) {
        clearInterval(intervalRef.current); intervalRef.current = null;
        setRunning(false); playEndSound();
        if ("Notification" in window && Notification.permission === "granted") {
          try { new Notification("üçÖ –í—Ä–µ–º–µ—Ç–æ –∏–∑—Ç–µ—á–µ!", { body: `${MODES[mode].emoji} ${MODES[mode].label} —Å–µ—Å–∏—è—Ç–∞ –ø—Ä–∏–∫–ª—é—á–∏!`, requireInteraction: true }); } catch {}
        }
        document.title = `‚úÖ ${MODES[mode].label} –ì–û–¢–û–í–û!`;
        setTimeout(() => { document.title = "C.A.L.M. Dashboard"; }, 10000);
        if (navigator.vibrate) navigator.vibrate([200, 100, 200, 100, 400]);
      }
    }, 250);
    const titleInterval = setInterval(() => {
      if (running && mode && endTimeRef.current) {
        const rem = Math.max(0, Math.round((endTimeRef.current - Date.now()) / 1000));
        document.title = `üçÖ ${formatTime(rem)} ‚Äî ${MODES[mode].label}`;
      }
    }, 1000);
    return () => { if (intervalRef.current) clearInterval(intervalRef.current); clearInterval(titleInterval); };
  }, [running, mode]);

  useEffect(() => { return () => { document.title = "C.A.L.M. Dashboard"; }; }, []);

  const pct = totalSeconds > 0 ? ((totalSeconds - secondsLeft) / totalSeconds) * 100 : 0;
  const currentMode = mode ? MODES[mode] : null;
  const isDone = mode && !running && secondsLeft <= 0;

  // ‚îÄ‚îÄ Idle state: mode selector ‚îÄ‚îÄ
  if (!mode) {
    return (
      <div style={{
        background: C.bgCard, borderRadius: 18, padding: "16px 20px",
        border: `1px solid ${C.border}`, marginBottom: 14,
        boxShadow: "0 2px 12px rgba(0,0,0,0.03)",
      }}>
        <div style={{ display: "flex", alignItems: "center", justifyContent: "space-between" }}>
          <div style={{ display: "flex", alignItems: "center", gap: 14 }}>
            <span style={{ fontSize: 44 }}>üçÖ</span>
            <div>
              <div style={{ fontSize: 20, fontWeight: 800, color: C.textPrimary }}>–ì–æ—Ç–æ–≤ –∑–∞ —Ä–∞–±–æ—Ç–∞?</div>
              <div style={{ fontSize: 14, color: C.textMuted }}>–ò–∑–±–µ—Ä–∏ —Ç–∏–ø–∞ –∑–∞–¥–∞—á–∞ –∏ –Ω–∞—Ç–∏—Å–Ω–∏ —Å—Ç–∞—Ä—Ç</div>
            </div>
          </div>
          <div style={{ display: "flex", gap: 8 }}>
            {Object.entries(MODES).map(([key, m]) => (
              <button key={key} onClick={() => startTimer(key)}
                style={{
                  padding: "12px 20px", borderRadius: 14,
                  border: `2px solid ${m.borderColor}`,
                  background: m.lightBg,
                  cursor: "pointer", display: "flex", alignItems: "center", gap: 8,
                  transition: "all 0.15s",
                }}
                onMouseDown={e => e.currentTarget.style.transform = "scale(0.95)"}
                onMouseUp={e => e.currentTarget.style.transform = "scale(1)"}
                onMouseLeave={e => e.currentTarget.style.transform = "scale(1)"}
              >
                <span style={{ fontSize: 20 }}>{m.emoji}</span>
                <div style={{ textAlign: "left" }}>
                  <div style={{ fontSize: 13, fontWeight: 800, color: m.color }}>{m.label}</div>
                  <div style={{ fontSize: 10, color: C.textMuted }}>{m.mins}</div>
                </div>
              </button>
            ))}
          </div>
        </div>
      </div>
    );
  }

  // ‚îÄ‚îÄ Active / Done state ‚îÄ‚îÄ
  return (
    <div style={{
      background: `linear-gradient(135deg, ${currentMode.lightBg} 0%, ${C.bgCard} 60%, ${currentMode.lightBg} 100%)`,
      borderRadius: 18, padding: "16px 24px",
      border: `2px solid ${isDone ? C.quickWin + "55" : currentMode.borderColor}`,
      marginBottom: 14,
      boxShadow: running ? `0 4px 24px ${currentMode.color}20` : "0 2px 12px rgba(0,0,0,0.03)",
      transition: "all 0.5s",
    }}>
      <div style={{ display: "flex", alignItems: "center", gap: 20 }}>
        {/* Circular progress ‚Äî large tomato */}
        <div style={{ position: "relative", width: 90, height: 90, flexShrink: 0 }}>
          <svg width="90" height="90" viewBox="0 0 90 90">
            {/* Track */}
            <circle cx="45" cy="45" r="38" fill="none" stroke={`${currentMode.color}15`} strokeWidth="7" />
            {/* Progress arc */}
            <circle cx="45" cy="45" r="38" fill="none"
              stroke={isDone ? C.quickWin : currentMode.color} strokeWidth="7"
              strokeDasharray={`${2 * Math.PI * 38}`}
              strokeDashoffset={`${2 * Math.PI * 38 * (1 - pct / 100)}`}
              strokeLinecap="round"
              transform="rotate(-90 45 45)"
              style={{ transition: "stroke-dashoffset 0.5s ease" }}
            />
          </svg>
          <div style={{
            position: "absolute", top: "50%", left: "50%",
            transform: "translate(-50%, -50%)", textAlign: "center",
          }}>
            {isDone ? (
              <div style={{ fontSize: 32 }}>‚úÖ</div>
            ) : (
              <div style={{ fontSize: 28, lineHeight: 1 }}>üçÖ</div>
            )}
          </div>
        </div>

        {/* Timer digits + label */}
        <div style={{ flex: 1 }}>
          <div style={{ display: "flex", alignItems: "baseline", gap: 10, marginBottom: 2 }}>
            <span style={{ fontSize: 14 }}>{currentMode.emoji}</span>
            <span style={{ fontSize: 14, fontWeight: 700, color: currentMode.color }}>{currentMode.label}</span>
            {running && (
              <span style={{
                fontSize: 10, color: currentMode.color, fontWeight: 600,
                padding: "2px 8px", borderRadius: 10,
                background: `${currentMode.color}12`,
                animation: "pulse 2s infinite",
              }}>‚óè –í –ü–†–û–ì–†–ï–°</span>
            )}
            {isDone && (
              <span style={{
                fontSize: 10, color: C.quickWin, fontWeight: 700,
                padding: "2px 8px", borderRadius: 10,
                background: `${C.quickWin}12`,
              }}>–ó–ê–í–™–†–®–ï–ù–û!</span>
            )}
          </div>
          
          {/* Big digits */}
          <div style={{
            fontSize: isDone ? 36 : secondsLeft >= 3600 ? 42 : 48,
            fontWeight: 900,
            color: isDone ? C.quickWin : C.textPrimary,
            fontVariantNumeric: "tabular-nums",
            letterSpacing: -1,
            lineHeight: 1,
          }}>
            {isDone ? "00:00" : formatTime(secondsLeft)}
          </div>
          
          {/* Slim progress bar */}
          <div style={{
            width: "100%", height: 4, background: `${currentMode.color}15`,
            borderRadius: 2, marginTop: 6, overflow: "hidden",
          }}>
            <div style={{
              height: "100%", borderRadius: 2,
              background: isDone ? C.quickWin : `linear-gradient(90deg, ${currentMode.color}, ${currentMode.color}BB)`,
              width: `${pct}%`,
              transition: "width 0.5s ease",
            }} />
          </div>
        </div>

        {/* Controls */}
        <div style={{ display: "flex", gap: 8, flexShrink: 0 }}>
          {isDone ? (
            <button onClick={stopTimer}
              style={{
                padding: "12px 24px", borderRadius: 14, border: "none",
                background: `linear-gradient(135deg, ${currentMode.color}, ${currentMode.color}CC)`,
                color: "#fff", fontSize: 14, fontWeight: 800, cursor: "pointer",
                boxShadow: `0 3px 12px ${currentMode.color}33`,
              }}
              onMouseDown={e => e.currentTarget.style.transform = "scale(0.95)"}
              onMouseUp={e => e.currentTarget.style.transform = "scale(1)"}
              onMouseLeave={e => e.currentTarget.style.transform = "scale(1)"}
            >–ù–æ–≤–∞ —Å–µ—Å–∏—è</button>
          ) : running ? (
            <>
              <button onClick={pauseTimer}
                style={{
                  padding: "12px 20px", borderRadius: 14,
                  border: `2px solid ${currentMode.borderColor}`,
                  background: currentMode.lightBg,
                  color: currentMode.color, fontSize: 18, fontWeight: 700, cursor: "pointer",
                }}
                onMouseDown={e => e.currentTarget.style.transform = "scale(0.93)"}
                onMouseUp={e => e.currentTarget.style.transform = "scale(1)"}
                onMouseLeave={e => e.currentTarget.style.transform = "scale(1)"}
              >‚è∏</button>
              <button onClick={stopTimer}
                style={{
                  padding: "12px 16px", borderRadius: 14,
                  border: `1px solid ${C.border}`, background: "#fff",
                  color: C.textMuted, fontSize: 14, fontWeight: 600, cursor: "pointer",
                }}
                onMouseDown={e => e.currentTarget.style.transform = "scale(0.93)"}
                onMouseUp={e => e.currentTarget.style.transform = "scale(1)"}
                onMouseLeave={e => e.currentTarget.style.transform = "scale(1)"}
              >‚úï</button>
            </>
          ) : (
            <>
              <button onClick={resumeTimer}
                style={{
                  padding: "12px 24px", borderRadius: 14, border: "none",
                  background: `linear-gradient(135deg, ${currentMode.color}, ${currentMode.color}CC)`,
                  color: "#fff", fontSize: 14, fontWeight: 800, cursor: "pointer",
                  boxShadow: `0 3px 12px ${currentMode.color}33`,
                }}
                onMouseDown={e => e.currentTarget.style.transform = "scale(0.95)"}
                onMouseUp={e => e.currentTarget.style.transform = "scale(1)"}
                onMouseLeave={e => e.currentTarget.style.transform = "scale(1)"}
              >‚ñ∂ –ü—Ä–æ–¥—ä–ª–∂–∏</button>
              <button onClick={stopTimer}
                style={{
                  padding: "12px 16px", borderRadius: 14,
                  border: `1px solid ${C.border}`, background: "#fff",
                  color: C.textMuted, fontSize: 14, fontWeight: 600, cursor: "pointer",
                }}>‚úï</button>
            </>
          )}
        </div>
      </div>
    </div>
  );
}

// ‚îÄ‚îÄ‚îÄ PROGRESS BAR ‚îÄ‚îÄ‚îÄ
function ProgressBar({ value, max, color, height = 8 }) {
  const pct = Math.min(100, max > 0 ? (value / max) * 100 : 0);
  return (
    <div style={{ width: "100%", height, backgroundColor: "#F0E6DE", borderRadius: height / 2, overflow: "hidden" }}>
      <div style={{
        width: `${pct}%`, height: "100%",
        background: `linear-gradient(90deg, ${color}, ${color}cc)`,
        borderRadius: height / 2,
        transition: "width 0.8s cubic-bezier(0.34, 1.56, 0.64, 1)",
      }} />
    </div>
  );
}

// ‚îÄ‚îÄ‚îÄ REVENUE MILESTONE BAR ‚îÄ‚îÄ‚îÄ
function RevenueMilestoneBar({ revenue, goal }) {
  const pct = Math.min(100, (revenue / goal) * 100);
  return (
    <div style={{ marginTop: 12 }}>
      <div style={{ position: "relative", height: 28, background: "#FFF8E7", borderRadius: 14, border: "1px solid #EDE0C0", overflow: "visible" }}>
        <div style={{
          height: "100%", borderRadius: 14,
          background: `linear-gradient(90deg, #C89520, #D4A017, #E8C547)`,
          width: `${pct}%`, transition: "width 1.2s cubic-bezier(0.34, 1.56, 0.64, 1)",
          display: "flex", alignItems: "center", justifyContent: "flex-end",
          paddingRight: pct > 8 ? 8 : 0, position: "relative",
          boxShadow: "0 2px 8px rgba(212,160,23,0.3)",
        }}>
          {pct > 15 && (
            <span style={{ fontSize: 11, fontWeight: 800, color: "#fff", textShadow: "0 1px 2px rgba(0,0,0,0.2)" }}>
              ‚Ç¨{revenue.toLocaleString()}
            </span>
          )}
        </div>
        {REVENUE_MILESTONES.map(m => {
          const mPct = (m / goal) * 100;
          const reached = revenue >= m;
          return (
            <div key={m} style={{
              position: "absolute", top: "50%", left: `${mPct}%`,
              transform: "translate(-50%, -50%)",
              width: reached ? 18 : 10, height: reached ? 18 : 10, borderRadius: "50%",
              background: reached ? "#fff" : "#EDE0C0",
              border: reached ? "2px solid #D4A017" : "1.5px solid #DDD0B8",
              display: "flex", alignItems: "center", justifyContent: "center",
              transition: "all 0.5s", zIndex: 2,
              boxShadow: reached ? "0 1px 4px rgba(212,160,23,0.3)" : "none",
            }}>
              {reached && <span style={{ fontSize: 8, color: "#D4A017" }}>‚ú¶</span>}
            </div>
          );
        })}
      </div>
      <div style={{ position: "relative", height: 18, marginTop: 4 }}>
        <span style={{ position: "absolute", left: 0, fontSize: 9, color: "#CCC" }}>‚Ç¨0</span>
        {REVENUE_MILESTONES.map(m => {
          const mPct = (m / goal) * 100;
          const reached = revenue >= m;
          return (
            <span key={m} style={{
              position: "absolute", left: `${mPct}%`, transform: "translateX(-50%)",
              fontSize: 9, color: reached ? "#D4A017" : "#CCC", fontWeight: reached ? 700 : 400,
            }}>‚Ç¨{m / 1000}K</span>
          );
        })}
      </div>
    </div>
  );
}

// ‚îÄ‚îÄ‚îÄ CELEBRATION OVERLAY ‚îÄ‚îÄ‚îÄ
function Celebration({ type, onDone, levelName }) {
  const [vis, setVis] = useState(true);
  const msgs = {
    quickWin: { emoji: "‚ö°", text: "Quick Win!", sub: "–ü—Ä–æ–¥—ä–ª–∂–∞–≤–∞–π!" },
    deepWork: { emoji: "üèîÔ∏è", text: "DEEP WORK!", sub: "–†–µ–∞–ª–µ–Ω –ø—Ä–æ–≥—Ä–µ—Å!" },
    learn: { emoji: "üìö", text: "–ó–ù–ê–ù–ò–ï!", sub: "–í—Å—è–∫–∞ –º–∏–Ω—É—Ç–∞ —É—á–µ–Ω–µ —Å–µ –æ—Ç–ø–ª–∞—â–∞" },
    levelUp: { emoji: "‚¨ÜÔ∏è", text: "LEVEL UP!", sub: levelName || "" },
    phaseComplete: { emoji: "üèÖ", text: "–§–ê–ó–ê –ó–ê–í–™–†–®–ï–ù–ê!", sub: "–ù–æ–≤–∞ —Ñ–∞–∑–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∞!" },
    revenue: { emoji: "üí∞", text: "MILESTONE!", sub: "–ü—Ä–∏—Ö–æ–¥–∏—Ç–µ —Ä–∞—Å—Ç–∞—Ç!" },
    weeklyRitual: { emoji: "üîÆ", text: "–°–ï–î–ú–ò–¶–ê–¢–ê –ó–ê–¢–í–û–†–ï–ù–ê!", sub: "C.A.L.M. —Ä–∏—Ç—É–∞–ª—ä—Ç –µ –∑–∞–≤—ä—Ä—à–µ–Ω" },
  };
  const m = msgs[type] || msgs.quickWin;
  useEffect(() => {
    const t = setTimeout(() => { setVis(false); onDone?.(); }, type === "weeklyRitual" ? 2500 : (type === "quickWin" || type === "learn") ? 1200 : 2000);
    return () => clearTimeout(t);
  }, [type, onDone]);
  if (!vis) return null;
  return (
    <div style={{
      position: "fixed", top: 0, left: 0, right: 0, bottom: 0,
      display: "flex", flexDirection: "column", alignItems: "center", justifyContent: "center",
      background: type === "weeklyRitual" ? "rgba(108,92,231,0.15)" : "rgba(255,255,255,0.85)",
      zIndex: 9998, animation: "popIn 0.3s ease", backdropFilter: "blur(4px)",
    }}>
      <div style={{ fontSize: 64, animation: "popIn 0.4s ease" }}>{m.emoji}</div>
      <div style={{ fontSize: 28, fontWeight: 900, color: type === "weeklyRitual" ? C.ritual : C.textPrimary, marginTop: 8, letterSpacing: 2 }}>{m.text}</div>
      {m.sub && <div style={{ fontSize: 15, color: "#666", marginTop: 4 }}>{m.sub}</div>}
    </div>
  );
}

// ‚îÄ‚îÄ‚îÄ STEPPER COMPONENT ‚îÄ‚îÄ‚îÄ
function Stepper({ value, onChange, color, lightBg, borderColor, emoji, label, hoursEach }) {
  const hours = value * hoursEach;
  return (
    <div style={{
      flex: 1, display: "flex", flexDirection: "column", alignItems: "center", gap: 6,
      padding: "12px 8px", borderRadius: 14,
      background: lightBg, border: `2px solid ${value > 0 ? color : borderColor}`,
      transition: "all 0.3s",
    }}>
      <div style={{ fontSize: 24 }}>{emoji}</div>
      <div style={{ fontSize: 11, fontWeight: 700, color: color }}>{label}</div>
      
      {/* Stepper controls */}
      <div style={{ display: "flex", alignItems: "center", gap: 0 }}>
        <button onClick={() => onChange(Math.max(0, value - 1))}
          style={{
            width: 36, height: 36, borderRadius: "50%",
            border: `2px solid ${borderColor}`, background: "#fff",
            fontSize: 20, fontWeight: 700, color: value > 0 ? color : "#CCC",
            cursor: value > 0 ? "pointer" : "default", display: "flex", alignItems: "center", justifyContent: "center",
            transition: "all 0.15s",
          }}
          onMouseDown={e => value > 0 && (e.currentTarget.style.transform = "scale(0.85)")}
          onMouseUp={e => e.currentTarget.style.transform = "scale(1)"}
          onMouseLeave={e => e.currentTarget.style.transform = "scale(1)"}
        >‚àí</button>
        
        <div style={{ 
          minWidth: 48, textAlign: "center",
          fontSize: 32, fontWeight: 900, color: value > 0 ? C.textPrimary : "#CCC",
          transition: "all 0.2s",
          transform: value > 0 ? "scale(1)" : "scale(0.9)",
        }}>
          {value}
        </div>
        
        <button onClick={() => onChange(value + 1)}
          style={{
            width: 36, height: 36, borderRadius: "50%",
            border: "none", background: `linear-gradient(135deg, ${color}, ${color}DD)`,
            fontSize: 20, fontWeight: 700, color: "#fff",
            cursor: "pointer", display: "flex", alignItems: "center", justifyContent: "center",
            boxShadow: `0 3px 10px ${color}33`, transition: "all 0.15s",
          }}
          onMouseDown={e => e.currentTarget.style.transform = "scale(0.85)"}
          onMouseUp={e => e.currentTarget.style.transform = "scale(1)"}
          onMouseLeave={e => e.currentTarget.style.transform = "scale(1)"}
        >+</button>
      </div>
      
      {/* Hours display */}
      <div style={{
        fontSize: 13, fontWeight: 700, color: value > 0 ? color : "#CCC",
        background: value > 0 ? `${color}12` : "transparent",
        padding: "2px 10px", borderRadius: 12,
        transition: "all 0.3s",
      }}>
        {hours.toFixed(hours % 1 === 0 ? 0 : 1)}—á
      </div>
    </div>
  );
}

// ‚îÄ‚îÄ‚îÄ MAIN WIDGET ‚îÄ‚îÄ‚îÄ
const DEFAULT = {
  deepWork: 0, quickWins: 0, currentPhase: 0, phasesCompleted: [],
  revenue: 0, revenueGoal: 5000, streakWeeks: 0, startDay: null, totalTasks: 25,
  weeklyCheckins: {},
  // weeklyCheckins: { "2026-W02-23": { deep: 3, quick: 5, learn: 2, streakContinued: true } }
};

function CALMDashboard() {
  const [state, setState] = useState(DEFAULT);
  const [currentWeek, setCurrentWeek] = useState(new Date());
  const [celebration, setCelebration] = useState(null);
  const [showSettings, setShowSettings] = useState(false);
  const [showDetails, setShowDetails] = useState(false);
  const [revenueInput, setRevenueInput] = useState("");
  const [viewMode, setViewMode] = useState("week");
  const [mounted, setMounted] = useState(false);
  const { particles, launch } = useConfetti();
  const [levelUpName, setLevelUpName] = useState("");
  const [moneyParticles, setMoneyParticles] = useState([]);

  // Check-in state
  const [checkinDeep, setCheckinDeep] = useState(0);
  const [checkinQuick, setCheckinQuick] = useState(0);
  const [checkinLearn, setCheckinLearn] = useState(0);
  const [checkinSaved, setCheckinSaved] = useState(false);

  useEffect(() => {
    setMounted(true);
    (async () => {
      try {
        const r = localStorage.getItem("calm-roadmap-v3");
        if (r) setState(JSON.parse(r));
      } catch {}
    })();
  }, []);

  const save = useCallback(async (s) => {
    try { localStorage.setItem("calm-roadmap-v3", JSON.stringify(s)); } catch {}
  }, []);

  const wk = weekKey(currentWeek);
  const { start: weekStart, end: weekEnd } = getWeekRange(currentWeek);
  const isCurrentWeek = weekKey(new Date()) === wk;

  // Load check-in data for current week
  useEffect(() => {
    const ci = state.weeklyCheckins[wk];
    if (ci) {
      setCheckinDeep(ci.deep || 0);
      setCheckinQuick(ci.quick || 0);
      setCheckinLearn(ci.learn || 0);
      setCheckinSaved(true);
    } else {
      setCheckinDeep(0);
      setCheckinQuick(0);
      setCheckinLearn(0);
      setCheckinSaved(false);
    }
  }, [wk, state.weeklyCheckins]);

  // Calculate hours from check-in data
  const calcHours = (ci) => ({
    deep: (ci?.deep || 0) * HOURS_PER.deep,
    quick: (ci?.quick || 0) * HOURS_PER.quick,
    learn: (ci?.learn || 0) * HOURS_PER.learn,
  });

  // Get current week's hours
  const currentCI = state.weeklyCheckins[wk];
  const weekHours = calcHours(currentCI);
  const totalHours = weekHours.deep + weekHours.quick + weekHours.learn;

  // Get weekly data for bar chart ‚Äî 13 weeks from startDay (full 90-day journey)
  const weeklyBarData = useMemo(() => {
    const weeks = [];
    const startDate = state.startDay ? new Date(state.startDay) : new Date();
    const { start: journeyStart } = getWeekRange(startDate);
    for (let i = 0; i < 13; i++) {
      const wd = new Date(journeyStart);
      wd.setDate(wd.getDate() + i * 7);
      const key = weekKey(wd);
      const { start } = getWeekRange(wd);
      const ci = state.weeklyCheckins[key];
      const h = calcHours(ci);
      const isFuture = wd > new Date();
      const isCurrent = weekKey(new Date()) === key;
      weeks.push({
        label: `–°${i + 1}`,
        sublabel: `${formatDate(start)}`,
        deep: h.deep,
        quick: h.quick,
        learn: h.learn,
        isFuture,
        isCurrent,
      });
    }
    return weeks;
  }, [state.startDay, state.weeklyCheckins]);

  // Cumulative 90-day totals (all check-ins)
  const cumulativeTotals = useMemo(() => {
    let deep = 0, quick = 0, learn = 0;
    Object.values(state.weeklyCheckins).forEach(ci => {
      const h = calcHours(ci);
      deep += h.deep;
      quick += h.quick;
      learn += h.learn;
    });
    const total = deep + quick + learn;
    return { deep, quick, learn, total };
  }, [state.weeklyCheckins]);

  // Period data for donut (week / 90-day views)
  const periodData = useMemo(() => {
    if (viewMode === "journey") {
      return { deep: cumulativeTotals.deep, quick: cumulativeTotals.quick, learn: cumulativeTotals.learn, total: cumulativeTotals.total, label: "90-–¥–Ω–µ–≤–µ–Ω –ø—ä—Ç" };
    } else {
      return { deep: weekHours.deep, quick: weekHours.quick, learn: weekHours.learn, total: totalHours, label: `${formatDate(weekStart)} ‚Äî ${formatDate(weekEnd)}` };
    }
  }, [viewMode, wk, cumulativeTotals, weekHours, totalHours, weekStart, weekEnd]);

  const totalDeep = periodData.deep;
  const totalQuick = periodData.quick;
  const totalLearn = periodData.learn;
  const totalPeriod = periodData.total;
  const deepPct = totalPeriod > 0 ? Math.round((totalDeep / totalPeriod) * 100) : 0;
  const quickPct = totalPeriod > 0 ? Math.round((totalQuick / totalPeriod) * 100) : 0;
  const learnPct = totalPeriod > 0 ? 100 - deepPct - quickPct : 0;

  const totalDone = state.quickWins + state.deepWork;
  const level = getLevel(state.deepWork);
  const dayNumber = state.startDay ? Math.min(90, Math.floor((Date.now() - state.startDay) / 86400000) + 1) : 0;

  const navigateWeek = (dir) => {
    const d = new Date(currentWeek);
    d.setDate(d.getDate() + dir * 7);
    setCurrentWeek(d);
  };
  const goToday = () => setCurrentWeek(new Date());

  // ‚îÄ‚îÄ‚îÄ WEEKLY CHECK-IN SAVE ‚îÄ‚îÄ‚îÄ
  const handleCheckinSave = useCallback(() => {
    const totalTasks = checkinDeep + checkinQuick + checkinLearn;
    if (totalTasks === 0) return;

    const newDW = state.deepWork + checkinDeep;
    const newQW = state.quickWins + checkinQuick;
    const newLevel = getLevel(newDW);
    const wasLevelUp = newLevel.name !== level.name;

    const ns = {
      ...state,
      deepWork: newDW,
      quickWins: newQW,
      streakWeeks: state.streakWeeks + 1,
      weeklyCheckins: {
        ...state.weeklyCheckins,
        [wk]: { deep: checkinDeep, quick: checkinQuick, learn: checkinLearn, savedAt: Date.now() },
      },
    };
    if (!ns.startDay) ns.startDay = Date.now();

    setState(ns);
    save(ns);
    setCheckinSaved(true);

    // Celebrations
    AudioEngine.playRitualComplete();
    launch("big");
    setCelebration("weeklyRitual");

    if (wasLevelUp) {
      setTimeout(() => {
        setLevelUpName(newLevel.emoji + " " + newLevel.name);
        setCelebration("levelUp");
        launch("big");
      }, 2800);
    }

    if (navigator.vibrate) navigator.vibrate([100, 50, 200, 50, 100]);
  }, [checkinDeep, checkinQuick, checkinLearn, state, level, wk, save, launch]);

  // ‚îÄ‚îÄ‚îÄ UNDO CHECK-IN ‚îÄ‚îÄ‚îÄ
  const handleCheckinUndo = useCallback(() => {
    const ci = state.weeklyCheckins[wk];
    if (!ci) return;

    const newCheckins = { ...state.weeklyCheckins };
    delete newCheckins[wk];

    const ns = {
      ...state,
      deepWork: Math.max(0, state.deepWork - (ci.deep || 0)),
      quickWins: Math.max(0, state.quickWins - (ci.quick || 0)),
      streakWeeks: Math.max(0, state.streakWeeks - 1),
      weeklyCheckins: newCheckins,
    };
    setState(ns);
    save(ns);
    setCheckinSaved(false);
    setCheckinDeep(0);
    setCheckinQuick(0);
    setCheckinLearn(0);
  }, [state, wk, save]);

  // Phase complete
  const handlePhaseComplete = useCallback((pid) => {
    if (state.phasesCompleted.includes(pid)) {
      const newCompleted = state.phasesCompleted.filter(id => id !== pid);
      const lowestUncompleted = PHASES.find(p => !newCompleted.includes(p.id));
      const ns = { ...state, phasesCompleted: newCompleted, currentPhase: lowestUncompleted ? lowestUncompleted.id : 0 };
      setState(ns); save(ns);
    } else {
      const newCompleted = [...state.phasesCompleted, pid];
      const nextUncompleted = PHASES.find(p => !newCompleted.includes(p.id));
      const ns = { ...state, phasesCompleted: newCompleted, currentPhase: nextUncompleted ? nextUncompleted.id : 7 };
      setState(ns); save(ns);
      AudioEngine.playLevelUp(); launch("big"); setCelebration("phaseComplete");
    }
  }, [state, save, launch]);

  // Money particles
  const moneyAnimRef = useRef(null);
  const moneyRef = useRef([]);
  const launchMoney = useCallback((intensity = "normal") => {
    const count = intensity === "big" ? 30 : 15;
    const moneyEmojis = ["üí∞", "üíµ", "üí∂", "ü™ô", "üí≤"];
    const newP = Array.from({ length: count }, (_, i) => ({
      id: Date.now() + i + Math.random() + 99999,
      x: window.innerWidth / 2 + (Math.random() - 0.5) * 300,
      y: window.innerHeight * 0.3 + Math.random() * 100,
      vx: (Math.random() - 0.5) * (intensity === "big" ? 18 : 10),
      vy: -Math.random() * 12 - 3,
      emoji: moneyEmojis[Math.floor(Math.random() * moneyEmojis.length)],
      size: 16 + Math.random() * 16,
      rotation: Math.random() * 360,
      rs: (Math.random() - 0.5) * 10,
      opacity: 1,
    }));
    moneyRef.current = [...moneyRef.current, ...newP];
    setMoneyParticles([...moneyRef.current]);
    if (!moneyAnimRef.current) {
      const anim = () => {
        moneyRef.current = moneyRef.current
          .map(p => ({ ...p, x: p.x + p.vx, y: p.y + p.vy, vy: p.vy + 0.35, vx: p.vx * 0.98, rotation: p.rotation + p.rs, opacity: p.opacity - 0.012 }))
          .filter(p => p.opacity > 0 && p.y < window.innerHeight + 50);
        setMoneyParticles([...moneyRef.current]);
        if (moneyRef.current.length > 0) moneyAnimRef.current = requestAnimationFrame(anim);
        else moneyAnimRef.current = null;
      };
      moneyAnimRef.current = requestAnimationFrame(anim);
    }
  }, []);

  const addRevenue = useCallback((amount) => {
    const newRevenue = state.revenue + amount;
    const oldM = REVENUE_MILESTONES.filter(m => state.revenue >= m).length;
    const newM = REVENUE_MILESTONES.filter(m => newRevenue >= m).length;
    const ns = { ...state, revenue: newRevenue };
    setState(ns); save(ns);
    AudioEngine.playRevenue();
    launchMoney("normal");
    if (newM > oldM) {
      setTimeout(() => {
        AudioEngine.playLevelUp(); launch("big"); launchMoney("big");
        setCelebration("revenue");
      }, 600);
    }
    if (navigator.vibrate) navigator.vibrate([50, 30, 50]);
  }, [state, save, launch, launchMoney]);

  const handleRevenue = useCallback(() => {
    const val = parseFloat(revenueInput);
    if (isNaN(val) || val <= 0) return;
    addRevenue(val);
    setRevenueInput("");
  }, [revenueInput, addRevenue]);

  const handleReset = () => { setState(DEFAULT); save(DEFAULT); setShowSettings(false); };

  if (!mounted) return null;

  // Check-in total hours preview
  const previewDeepH = checkinDeep * HOURS_PER.deep;
  const previewQuickH = checkinQuick * HOURS_PER.quick;
  const previewLearnH = checkinLearn * HOURS_PER.learn;
  const previewTotal = previewDeepH + previewQuickH + previewLearnH;
  const previewTasks = checkinDeep + checkinQuick + checkinLearn;

  return (
    <div style={{ minHeight: "100vh", background: C.bg, fontFamily: "'Segoe UI', -apple-system, system-ui, sans-serif", padding: "20px 24px", margin: "0 auto" }}>
      <style>{`
        @keyframes popIn { 0%{transform:scale(0.3);opacity:0} 50%{transform:scale(1.1)} 100%{transform:scale(1);opacity:1} }
        @keyframes pulse { 0%,100%{transform:scale(1)} 50%{transform:scale(1.03)} }
        @keyframes slideUp { from{opacity:0;transform:translateY(15px)} to{opacity:1;transform:translateY(0)} }
        @keyframes glow { 0%,100%{box-shadow:0 0 8px rgba(232,129,58,0.15)} 50%{box-shadow:0 0 20px rgba(232,129,58,0.35)} }
        @keyframes ritualPulse { 0%,100%{box-shadow:0 0 12px rgba(108,92,231,0.15)} 50%{box-shadow:0 0 28px rgba(108,92,231,0.35)} }
        @keyframes shimmer { 0%{background-position:-200% 0} 100%{background-position:200% 0} }
        * { box-sizing: border-box; }
        @media (max-width: 768px) {
          .grid-top { grid-template-columns: 1fr !important; }
          .pomodoro-buttons { flex-direction: column !important; }
          .pomodoro-active { flex-direction: column !important; align-items: center !important; text-align: center; }
          .grid-stats { grid-template-columns: 1fr !important; }
          .grid-2col { grid-template-columns: 1fr !important; }
          .grid-3col { grid-template-columns: 1fr !important; }
          .checkin-steppers { flex-direction: column !important; }
          .nav-row { flex-direction: column !important; gap: 8px !important; }
          .revenue-row { flex-wrap: wrap !important; }
          .trophy-grid { grid-template-columns: repeat(4, 1fr) !important; }
        }
      `}</style>

      {/* Confetti */}
      {particles.map(p => (
        <div key={p.id} style={{
          position: "fixed", left: p.x, top: p.y,
          width: p.shape === "circle" ? p.size : p.size * 0.6,
          height: p.shape === "circle" ? p.size : p.size * 1.2,
          backgroundColor: p.color, borderRadius: p.shape === "circle" ? "50%" : 2,
          transform: `rotate(${p.rotation}deg)`, opacity: p.opacity,
          pointerEvents: "none", zIndex: 9999,
        }} />
      ))}
      {moneyParticles.map(p => (
        <div key={p.id} style={{
          position: "fixed", left: p.x, top: p.y, fontSize: p.size,
          transform: `rotate(${p.rotation}deg)`, opacity: p.opacity,
          pointerEvents: "none", zIndex: 9999, userSelect: "none",
        }}>{p.emoji}</div>
      ))}

      {celebration && <Celebration type={celebration} onDone={() => setCelebration(null)} levelName={levelUpName} />}

      {/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
           HEADER
         ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */}
      {/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
           POMODORO TIMER (Full-width hero)
         ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */}
      <PomodoroTimer />

      {/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
           DASHBOARD + BREATHING
         ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */}
      <div className="grid-top" style={{ display: "grid", gridTemplateColumns: "1fr 210px", gap: 14, marginBottom: 14 }}>
        <div style={{ background: C.bgCard, borderRadius: 16, padding: 18, border: `1px solid ${C.border}` }}>
          {/* Header */}
          <div style={{ display: "flex", alignItems: "center", justifyContent: "space-between", marginBottom: 16 }}>
            <div style={{ display: "flex", alignItems: "center", gap: 8 }}>
              <span style={{ fontSize: 16 }}>üìÖ</span>
              <span style={{ fontSize: 13, fontWeight: 800, color: C.textPrimary, textTransform: "uppercase", letterSpacing: 0.5 }}>
                {viewMode === "journey" ? "90-–¥–Ω–µ–≤–Ω–∞" : "–°–µ–¥–º–∏—á–Ω–∞"} –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç
              </span>
            </div>
            <div style={{ display: "flex", alignItems: "center", gap: 14 }}>
              {/* View toggle */}
              <div style={{ display: "flex", gap: 2, background: "#F5F5F5", borderRadius: 8, padding: 2 }}>
                {[
                  { key: "week", label: "–°–µ–¥–º–∏—Ü–∞" },
                  { key: "journey", label: "90 –¥–Ω–∏" },
                ].map(tab => (
                  <button key={tab.key} onClick={() => setViewMode(tab.key)}
                    style={{
                      padding: "4px 10px", borderRadius: 6, border: "none",
                      background: viewMode === tab.key ? C.accent : "transparent",
                      color: viewMode === tab.key ? "#fff" : C.textMuted,
                      fontSize: 11, fontWeight: viewMode === tab.key ? 700 : 400,
                      cursor: "pointer", transition: "all 0.2s",
                    }}>
                    {tab.label}
                  </button>
                ))}
              </div>
              {/* Level badge */}
              <div style={{
                display: "flex", alignItems: "center", gap: 5,
                padding: "4px 10px", borderRadius: 20,
                background: `${level.color}12`, border: `1px solid ${level.color}25`,
              }}>
                <span style={{ fontSize: 16 }}>{level.emoji}</span>
                <span style={{ fontSize: 11, fontWeight: 700, color: level.color }}>{level.name}</span>
              </div>
              {/* Streak */}
              <div style={{
                display: "flex", alignItems: "center", gap: 4,
                padding: "4px 10px", borderRadius: 20,
                background: state.streakWeeks > 0 ? `${C.orange}12` : "#F5F5F5",
                border: `1px solid ${state.streakWeeks > 0 ? C.orange + "25" : C.border}`,
              }}>
                <span style={{ fontSize: 14 }}>{state.streakWeeks > 0 ? "üî•" : "üí§"}</span>
                <span style={{ fontSize: 11, fontWeight: 700, color: state.streakWeeks > 0 ? C.orange : C.textMuted }}>
                  {state.streakWeeks > 0 ? `${state.streakWeeks} —Å–µ–¥.` : "0"}
                </span>
              </div>
              {/* Day */}
              <div style={{ textAlign: "right" }}>
                <span style={{ fontSize: 11, color: C.textMuted }}>–î–µ–Ω </span>
                <span style={{ fontSize: 20, fontWeight: 900, color: C.textPrimary }}>{dayNumber}</span>
                <span style={{ fontSize: 11, color: C.textMuted }}> / 90</span>
              </div>
            </div>
          </div>

          {/* Donut + Breakdown */}
          <div style={{ display: "flex", gap: 20, alignItems: "center" }}>
            <div style={{ flexShrink: 0 }}>
              <DonutChart deepHours={totalDeep} quickHours={totalQuick} learnHours={totalLearn} size={195} viewMode={viewMode} />
            </div>
            <div style={{ flex: 1, display: "flex", flexDirection: "column", gap: 10 }}>
              {[
                { label: "Deep Work", emoji: "üèîÔ∏è", val: totalDeep, pct: deepPct, color: C.deepWork, bg: C.deepWorkLight, borderC: C.deepWorkBorder },
                { label: "Quick Wins", emoji: "‚ö°", val: totalQuick, pct: quickPct, color: C.quickWin, bg: C.quickWinLight, borderC: C.quickWinBorder },
                { label: "Learn", emoji: "üìö", val: totalLearn, pct: learnPct, color: C.learn, bg: C.learnLight, borderC: C.learnBorder },
              ].map(cat => (
                <div key={cat.label} style={{
                  display: "flex", alignItems: "center", gap: 10,
                  padding: "8px 12px", borderRadius: 12,
                  background: cat.bg, border: `1px solid ${cat.borderC}`,
                }}>
                  <span style={{ fontSize: 20, flexShrink: 0 }}>{cat.emoji}</span>
                  <div style={{ flex: 1 }}>
                    <div style={{ display: "flex", justifyContent: "space-between", alignItems: "baseline", marginBottom: 4 }}>
                      <span style={{ fontSize: 12, fontWeight: 700, color: cat.color }}>{cat.label}</span>
                      <span style={{ fontSize: 15, fontWeight: 900, color: cat.color }}>{cat.val.toFixed(1)}—á <span style={{ fontSize: 11, fontWeight: 500, color: C.textMuted }}>({cat.pct}%)</span></span>
                    </div>
                    <div style={{ width: "100%", height: 8, backgroundColor: "rgba(255,255,255,0.7)", borderRadius: 4, overflow: "hidden" }}>
                      <div style={{
                        width: `${Math.max(Math.min(cat.pct, 100), cat.val > 0 ? 3 : 0)}%`, height: "100%", borderRadius: 4,
                        background: `linear-gradient(90deg, ${cat.color}, ${cat.color}BB)`,
                        transition: "width 0.8s ease", boxShadow: `0 1px 3px ${cat.color}33`,
                      }} />
                    </div>
                  </div>
                </div>
              ))}
            </div>
          </div>
        </div>

        <BoxBreathing />
      </div>

      {/* ‚ïê‚ïê‚ïê DETAILS TOGGLE ‚ïê‚ïê‚ïê */}
      <button onClick={() => setShowDetails(!showDetails)}
        style={{
          width: "100%", padding: "14px 20px", borderRadius: 14, border: "none",
          background: showDetails
            ? `linear-gradient(135deg, ${C.accent}, ${C.accent}DD)`
            : !checkinSaved && isCurrentWeek
            ? `linear-gradient(135deg, ${C.ritual}, #8B5CF6)`
            : `linear-gradient(135deg, #4A6FA5, #5B8BC9)`,
          cursor: "pointer", fontSize: 13, fontWeight: 700, color: "#fff",
          marginBottom: 14, display: "flex", alignItems: "center", justifyContent: "center", gap: 10,
          transition: "all 0.3s",
          boxShadow: showDetails
            ? `0 4px 14px ${C.accent}33`
            : !checkinSaved && isCurrentWeek
            ? "0 4px 14px rgba(108,92,231,0.35)"
            : "0 4px 14px rgba(74,111,165,0.25)",
          animation: !showDetails && !checkinSaved && isCurrentWeek ? "ritualPulse 3s infinite" : "none",
        }}
        onMouseDown={e => e.currentTarget.style.transform = "scale(0.98)"}
        onMouseUp={e => e.currentTarget.style.transform = "scale(1)"}
        onMouseLeave={e => e.currentTarget.style.transform = "scale(1)"}
      >
        <span style={{
          display: "inline-flex", alignItems: "center", justifyContent: "center",
          width: 22, height: 22, borderRadius: 6, background: "rgba(255,255,255,0.2)",
          fontSize: 11, transition: "transform 0.3s",
          transform: showDetails ? "rotate(180deg)" : "rotate(0deg)",
        }}>‚ñº</span>
        <span>{showDetails ? "–°–∫—Ä–∏–π –¥–µ—Ç–∞–π–ª–∏—Ç–µ" : checkinSaved ? "–í–∏–∂ –≥—Ä–∞—Ñ–∏–∫–∏, –ø—Ä–∏—Ö–æ–¥–∏ –∏ roadmap ‚Üí" : "üîÆ –°–µ–¥–º–∏—á–µ–Ω —Ä–∏—Ç—É–∞–ª, –≥—Ä–∞—Ñ–∏–∫–∏ –∏ roadmap ‚Üí"}</span>
      </button>

      {/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
           ZONE 2: DETAILS (Collapsible)
         ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */}
      {showDetails && (
        <div style={{ animation: "slideUp 0.3s ease" }}>

          {/* ‚ïê‚ïê‚ïê WEEKLY CHECK-IN RITUAL ‚ïê‚ïê‚ïê */}
          <div style={{
            background: checkinSaved
              ? `linear-gradient(135deg, ${C.ritualLight} 0%, #F0FFF4 100%)`
              : `linear-gradient(135deg, ${C.bgCard} 0%, ${C.ritualLight} 100%)`,
            borderRadius: 20, padding: 20,
            border: checkinSaved ? `2px solid ${C.quickWin}55` : `2px solid ${C.ritualBorder}`,
            marginBottom: 14,
            boxShadow: checkinSaved ? "0 4px 20px rgba(91,189,114,0.12)" : "0 4px 20px rgba(108,92,231,0.08)",
            animation: !checkinSaved && isCurrentWeek ? "ritualPulse 3s infinite" : "none",
            transition: "all 0.5s",
          }}>
            <div style={{ display: "flex", alignItems: "center", justifyContent: "space-between", marginBottom: 14 }}>
              <div style={{ display: "flex", alignItems: "center", gap: 10 }}>
                <div style={{
                  width: 42, height: 42, borderRadius: 12,
                  background: checkinSaved
                    ? `linear-gradient(135deg, ${C.quickWin}20, ${C.quickWin}08)`
                    : `linear-gradient(135deg, ${C.ritual}20, ${C.ritual}08)`,
                  display: "flex", alignItems: "center", justifyContent: "center", fontSize: 22,
                }}>
                  {checkinSaved ? "‚úÖ" : "üîÆ"}
                </div>
                <div>
                  <div style={{ fontSize: 15, fontWeight: 800, color: checkinSaved ? C.quickWin : C.ritual }}>
                    {checkinSaved ? "–°–µ–¥–º–∏—Ü–∞—Ç–∞ –µ –∑–∞—Ç–≤–æ—Ä–µ–Ω–∞!" : "–°–µ–¥–º–∏—á–µ–Ω Check-in"}
                  </div>
                  <div style={{ fontSize: 11, color: C.textMuted }}>
                    {formatDate(weekStart)} ‚Äî {formatDate(weekEnd)}
                    {checkinSaved && " ¬∑ C.A.L.M. ‚úì"}
                  </div>
                </div>
              </div>
              <div style={{ display: "flex", alignItems: "center", gap: 6 }}>
                <button onClick={() => navigateWeek(-1)} style={{ width: 28, height: 28, borderRadius: 8, border: `1px solid ${C.border}`, background: "#fff", cursor: "pointer", fontSize: 12, display: "flex", alignItems: "center", justifyContent: "center", color: C.textSecondary }}>‚Äπ</button>
                {!isCurrentWeek && (
                  <button onClick={goToday} style={{ padding: "4px 10px", borderRadius: 8, border: `1px solid ${C.border}`, background: "#fff", cursor: "pointer", fontSize: 11, color: C.textSecondary }}>–¢–∞–∑–∏</button>
                )}
                <button onClick={() => navigateWeek(1)} style={{ width: 28, height: 28, borderRadius: 8, border: `1px solid ${C.border}`, background: "#fff", cursor: "pointer", fontSize: 12, display: "flex", alignItems: "center", justifyContent: "center", color: C.textSecondary }}>‚Ä∫</button>
              </div>
            </div>

            {!checkinSaved && (
              <div style={{ fontSize: 12, color: C.textSecondary, marginBottom: 14, padding: "8px 12px", borderRadius: 10, background: "rgba(108,92,231,0.05)", border: "1px solid rgba(108,92,231,0.1)" }}>
                –û—Ç–≤–æ—Ä–∏ Notion ‚Üí –ø–æ–≥–ª–µ–¥–Ω–∏ –∫–æ–ª–∫–æ –∑–∞–¥–∞—á–∏ –æ—Ç –≤—Å—è–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—è –º–∞—Ä–∫–∏—Ä–∞ –∫–∞—Ç–æ Done —Ç–∞–∑–∏ —Å–µ–¥–º–∏—Ü–∞ ‚Üí –≤—ä–≤–µ–¥–∏ –±—Ä–æ–π–∫–∏—Ç–µ —Ç—É–∫.
              </div>
            )}

            <div className="checkin-steppers" style={{ display: "flex", gap: 12, marginBottom: 14, opacity: checkinSaved ? 0.6 : 1, pointerEvents: checkinSaved ? "none" : "auto" }}>
              <Stepper value={checkinDeep} onChange={setCheckinDeep} color={C.deepWork} lightBg={C.deepWorkLight} borderColor={C.deepWorkBorder} emoji="üèîÔ∏è" label="Deep Work" hoursEach={HOURS_PER.deep} />
              <Stepper value={checkinQuick} onChange={setCheckinQuick} color={C.quickWin} lightBg={C.quickWinLight} borderColor={C.quickWinBorder} emoji="‚ö°" label="Quick Wins" hoursEach={HOURS_PER.quick} />
              <Stepper value={checkinLearn} onChange={setCheckinLearn} color={C.learn} lightBg={C.learnLight} borderColor={C.learnBorder} emoji="üìö" label="Learn" hoursEach={HOURS_PER.learn} />
            </div>

            {!checkinSaved ? (
              <div style={{ display: "flex", alignItems: "center", gap: 12 }}>
                <div style={{
                  flex: 1, display: "flex", alignItems: "center", gap: 14,
                  padding: "10px 14px", borderRadius: 12,
                  background: previewTasks > 0 ? "rgba(108,92,231,0.06)" : "#F8F8F8",
                  border: `1px solid ${previewTasks > 0 ? C.ritualBorder : C.border}`,
                  transition: "all 0.3s",
                }}>
                  <div>
                    <div style={{ fontSize: 11, color: C.textMuted }}>–ó–∞–¥–∞—á–∏</div>
                    <div style={{ fontSize: 22, fontWeight: 900, color: previewTasks > 0 ? C.textPrimary : "#CCC" }}>{previewTasks}</div>
                  </div>
                  <div style={{ width: 1, height: 30, background: C.border }} />
                  <div>
                    <div style={{ fontSize: 11, color: C.textMuted }}>–û–±—â–æ —á–∞—Å–æ–≤–µ</div>
                    <div style={{ fontSize: 22, fontWeight: 900, color: previewTasks > 0 ? C.ritual : "#CCC" }}>{previewTotal.toFixed(1)}—á</div>
                  </div>
                  {previewTasks > 0 && (
                    <>
                      <div style={{ width: 1, height: 30, background: C.border }} />
                      <div style={{ display: "flex", gap: 8 }}>
                        {previewDeepH > 0 && <span style={{ fontSize: 10, color: C.deepWork, fontWeight: 700 }}>üèîÔ∏è{previewDeepH}—á</span>}
                        {previewQuickH > 0 && <span style={{ fontSize: 10, color: C.quickWin, fontWeight: 700 }}>‚ö°{previewQuickH}—á</span>}
                        {previewLearnH > 0 && <span style={{ fontSize: 10, color: C.learn, fontWeight: 700 }}>üìö{previewLearnH}—á</span>}
                      </div>
                    </>
                  )}
                </div>
                <button onClick={handleCheckinSave} disabled={previewTasks === 0}
                  style={{
                    padding: "14px 24px", borderRadius: 14, border: "none",
                    background: previewTasks > 0 ? `linear-gradient(135deg, ${C.ritual}, #8B5CF6)` : "#E0E0E0",
                    color: previewTasks > 0 ? "#fff" : "#999",
                    fontSize: 14, fontWeight: 800,
                    cursor: previewTasks > 0 ? "pointer" : "default",
                    boxShadow: previewTasks > 0 ? "0 4px 16px rgba(108,92,231,0.3)" : "none",
                    transition: "all 0.3s", whiteSpace: "nowrap",
                  }}
                  onMouseDown={e => previewTasks > 0 && (e.currentTarget.style.transform = "scale(0.95)")}
                  onMouseUp={e => e.currentTarget.style.transform = "scale(1)"}
                  onMouseLeave={e => e.currentTarget.style.transform = "scale(1)"}
                >üöÄ –ó–∞—Ç–≤–æ—Ä–∏ —Å–µ–¥–º–∏—Ü–∞—Ç–∞</button>
              </div>
            ) : (
              <div style={{ display: "flex", alignItems: "center", justifyContent: "space-between" }}>
                <div style={{ display: "flex", alignItems: "center", gap: 14 }}>
                  <div style={{ textAlign: "center" }}>
                    <div style={{ fontSize: 11, color: C.textMuted }}>–ó–∞–¥–∞—á–∏</div>
                    <div style={{ fontSize: 20, fontWeight: 900, color: C.textPrimary }}>{previewTasks}</div>
                  </div>
                  <div style={{ width: 1, height: 28, background: C.border }} />
                  <div style={{ textAlign: "center" }}>
                    <div style={{ fontSize: 11, color: C.textMuted }}>–ß–∞—Å–æ–≤–µ</div>
                    <div style={{ fontSize: 20, fontWeight: 900, color: C.ritual }}>{previewTotal.toFixed(1)}—á</div>
                  </div>
                  <div style={{ width: 1, height: 28, background: C.border }} />
                  <div style={{ display: "flex", gap: 8, alignItems: "center" }}>
                    {previewDeepH > 0 && <span style={{ fontSize: 11, color: C.deepWork, fontWeight: 700 }}>üèîÔ∏è {previewDeepH}—á</span>}
                    {previewQuickH > 0 && <span style={{ fontSize: 11, color: C.quickWin, fontWeight: 700 }}>‚ö° {previewQuickH}—á</span>}
                    {previewLearnH > 0 && <span style={{ fontSize: 11, color: C.learn, fontWeight: 700 }}>üìö {previewLearnH}—á</span>}
                  </div>
                </div>
                <button onClick={handleCheckinUndo}
                  style={{ padding: "6px 14px", borderRadius: 8, border: `1px solid ${C.border}`, background: "#fff", fontSize: 11, color: C.textMuted, cursor: "pointer" }}>
                  ‚Ü© –†–µ–¥–∞–∫—Ç–∏—Ä–∞–π
                </button>
              </div>
            )}
          </div>

          {/* ‚ïê‚ïê‚ïê 90-DAY BAR CHART ‚ïê‚ïê‚ïê */}
          <div style={{
            background: `linear-gradient(180deg, ${C.bgCard} 0%, #FAFAF8 100%)`,
            borderRadius: 16, padding: "20px 24px",
            border: `1px solid ${C.border}`, marginBottom: 14,
          }}>
            <BarChart weeklyData={weeklyBarData} dayNumber={dayNumber} />
          </div>

          {/* Revenue + Roadmap */}
          <div className="grid-2col" style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 14, marginBottom: 14 }}>
            {/* Revenue */}
            <div style={{ background: C.bgCard, borderRadius: 14, padding: 16, border: `1px solid ${C.border}` }}>
              <div style={{ display: "flex", alignItems: "center", justifyContent: "space-between", marginBottom: 10 }}>
                <div style={{ fontSize: 11, color: C.textMuted, textTransform: "uppercase", letterSpacing: 1.5 }}>üí∞ North Star</div>
                <div style={{ fontSize: 18, fontWeight: 800, color: C.gold }}>‚Ç¨{state.revenue.toLocaleString()}<span style={{ fontSize: 12, color: C.textMuted }}> / ‚Ç¨{(state.revenueGoal / 1000).toFixed(0)}K</span></div>
              </div>
              <RevenueMilestoneBar revenue={state.revenue} goal={state.revenueGoal} />
              <div className="revenue-row" style={{ display: "flex", gap: 6, marginTop: 10, borderTop: `1px solid ${C.border}`, paddingTop: 10, alignItems: "center", flexWrap: "wrap" }}>
                <div style={{ display: "flex", gap: 4 }}>
                  {[10, 50, 100, 500].map(amt => (
                    <button key={amt} onClick={() => addRevenue(amt)}
                      style={{ padding: "8px 10px", borderRadius: 8, border: `1px solid #EDE0C0`, background: C.goldLight, fontSize: 12, cursor: "pointer", color: "#7A6210", fontWeight: 700, minWidth: 42, transition: "transform 0.1s" }}
                      onMouseDown={e => e.currentTarget.style.transform = "scale(0.93)"}
                      onMouseUp={e => e.currentTarget.style.transform = "scale(1)"}
                      onMouseLeave={e => e.currentTarget.style.transform = "scale(1)"}
                    >+‚Ç¨{amt}</button>
                  ))}
                </div>
                <div style={{ display: "flex", gap: 4, flex: 1, minWidth: 140 }}>
                  <input type="number" step="10" min="0" value={revenueInput} onChange={e => setRevenueInput(e.target.value)}
                    placeholder="–î—Ä—É–≥–∞ —Å—É–º–∞ ‚Ç¨" onKeyDown={e => e.key === "Enter" && handleRevenue()}
                    style={{ flex: 1, padding: "7px 10px", borderRadius: 8, border: `1px solid ${C.border}`, fontSize: 12, outline: "none", background: "#FAFAFA", minWidth: 80 }}
                  />
                  <button onClick={handleRevenue}
                    style={{ padding: "7px 14px", borderRadius: 8, border: "none", background: C.gold, color: "#fff", fontWeight: 700, cursor: "pointer", fontSize: 12, whiteSpace: "nowrap" }}>
                    üí∞ –î–æ–±–∞–≤–∏
                  </button>
                </div>
              </div>
              <div style={{ display: "flex", gap: 4, marginTop: 6, alignItems: "center", flexWrap: "wrap" }}>
                <div style={{ fontSize: 10, color: C.textMuted, marginRight: 2 }}>–ö–æ—Ä–µ–∫—Ü–∏—è:</div>
                {[10, 50, 100, 500].map(amt => (
                  <button key={amt} onClick={() => { const ns = { ...state, revenue: Math.max(0, state.revenue - amt) }; setState(ns); save(ns); }}
                    style={{ padding: "5px 8px", borderRadius: 6, border: `1px solid #F0E6DE`, background: "#FAFAFA", fontSize: 11, cursor: "pointer", color: "#999", fontWeight: 600, minWidth: 38 }}
                    onMouseDown={e => e.currentTarget.style.transform = "scale(0.93)"}
                    onMouseUp={e => e.currentTarget.style.transform = "scale(1)"}
                    onMouseLeave={e => e.currentTarget.style.transform = "scale(1)"}
                  >‚àí‚Ç¨{amt}</button>
                ))}
              </div>

              {/* Milestone Rewards */}
              <div style={{ marginTop: 12, paddingTop: 10, borderTop: `1px solid ${C.border}` }}>
                <div style={{ fontSize: 10, color: C.textMuted, marginBottom: 6, textTransform: "uppercase", letterSpacing: 1 }}>üéÅ –û—Ç–∫–ª—é—á–µ–Ω–∏ –Ω–∞–≥—Ä–∞–¥–∏</div>
                <div style={{ display: "flex", justifyContent: "space-between", gap: 4 }}>
                  {[
                    { at: 100, emoji: "üçΩÔ∏è", label: "–í–µ—á–µ—Ä—è" },
                    { at: 500, emoji: "üéß", label: "–°–ª—É—à–∞–ª–∫–∏" },
                    { at: 1000, emoji: "üèñÔ∏è", label: "–£–∏–∫–µ–Ω–¥" },
                    { at: 1500, emoji: "üì±", label: "–¢–µ–ª–µ—Ñ–æ–Ω" },
                    { at: 2000, emoji: "üíª", label: "–õ–∞–ø—Ç–æ–ø" },
                    { at: 2500, emoji: "‚úàÔ∏è", label: "–ü—ä—Ç—É–≤–∞–Ω–µ" },
                    { at: 3000, emoji: "üöó", label: "–ö–æ–ª–∞" },
                    { at: 3500, emoji: "üè°", label: "–†–µ–º–æ–Ω—Ç" },
                    { at: 4000, emoji: "üß†", label: "Mastermind" },
                    { at: 5000, emoji: "üèÜ", label: "–°–í–û–ë–û–î–ê" },
                  ].map(r => {
                    const unlocked = state.revenue >= r.at;
                    return (
                      <div key={r.at} style={{ display: "flex", flexDirection: "column", alignItems: "center", gap: 2, flex: 1, minWidth: 0 }} title={`‚Ç¨${r.at} ‚Äî ${r.label}`}>
                        <div style={{ fontSize: 20, filter: unlocked ? "none" : "grayscale(1) opacity(0.25)", transition: "all 0.5s" }}>{r.emoji}</div>
                        <div style={{ fontSize: 7, fontWeight: unlocked ? 700 : 400, color: unlocked ? C.gold : "#CCC", whiteSpace: "nowrap", overflow: "hidden", textOverflow: "ellipsis", maxWidth: "100%", textAlign: "center" }}>{r.label}</div>
                        <div style={{ fontSize: 7, color: unlocked ? C.gold : "#DDD", fontWeight: unlocked ? 600 : 400 }}>‚Ç¨{r.at >= 1000 ? `${r.at/1000}K` : r.at}</div>
                      </div>
                    );
                  })}
                </div>
              </div>
            </div>

            {/* Roadmap */}
            <div style={{ background: C.bgCard, borderRadius: 14, padding: 16, border: `1px solid ${C.border}`, display: "flex", flexDirection: "column" }}>
              <div style={{ display: "flex", alignItems: "center", justifyContent: "space-between", marginBottom: 10 }}>
                <div style={{ fontSize: 11, color: C.textMuted, textTransform: "uppercase", letterSpacing: 1.5 }}>üìç Roadmap</div>
                <div style={{ fontSize: 15, fontWeight: 700, color: C.textPrimary }}>
                  Phase {state.currentPhase}: <span style={{ color: C.accent }}>{PHASES[state.currentPhase]?.name}</span>
                </div>
              </div>

              <div style={{ position: "relative", height: 24, background: "#F0F4FF", borderRadius: 12, border: "1px solid #D8E2F0", overflow: "visible", marginBottom: 14 }}>
                <div style={{
                  height: "100%", borderRadius: 12,
                  background: state.phasesCompleted.length > 0 ? `linear-gradient(90deg, #3A7BD5, #4A90D9, #6BA8E8)` : "transparent",
                  width: `${(state.phasesCompleted.length / PHASES.length) * 100}%`,
                  transition: "width 1.2s cubic-bezier(0.34, 1.56, 0.64, 1)",
                  display: "flex", alignItems: "center", justifyContent: "flex-end",
                  paddingRight: state.phasesCompleted.length > 0 ? 8 : 0,
                  boxShadow: state.phasesCompleted.length > 0 ? "0 2px 8px rgba(74,144,217,0.3)" : "none",
                }}>
                  {state.phasesCompleted.length > 0 && (
                    <span style={{ fontSize: 10, fontWeight: 800, color: "#fff" }}>{state.phasesCompleted.length}/{PHASES.length}</span>
                  )}
                </div>
                {PHASES.map((p, i) => {
                  const mPct = ((i + 1) / PHASES.length) * 100;
                  const done = state.phasesCompleted.includes(i);
                  return (
                    <div key={i} style={{
                      position: "absolute", top: "50%", left: `${mPct}%`, transform: "translate(-50%, -50%)",
                      width: done ? 14 : 8, height: done ? 14 : 8, borderRadius: "50%",
                      background: done ? "#fff" : "#D8E2F0", border: done ? "2px solid #4A90D9" : "1px solid #C0D0E0",
                      transition: "all 0.5s", zIndex: 2,
                    }}>
                      {done && <div style={{ width: 4, height: 4, borderRadius: "50%", background: "#4A90D9", margin: "auto", marginTop: 3 }} />}
                    </div>
                  );
                })}
              </div>

              <div style={{ display: "grid", gridTemplateColumns: "repeat(8, 1fr)", gap: 6, marginBottom: 14 }}>
                {PHASES.map(p => {
                  const done = state.phasesCompleted.includes(p.id);
                  const cur = state.currentPhase === p.id;
                  return (
                    <button key={p.id} onClick={() => handlePhaseComplete(p.id)}
                      title={done ? `–ö–ª–∏–∫–Ω–∏ –∑–∞ –æ—Ç–º—è–Ω–∞ ¬∑ ${p.badgeText}` : `–ö–ª–∏–∫–Ω–∏ –ø—Ä–∏ –∑–∞–≤—ä—Ä—à–≤–∞–Ω–µ ¬∑ ${p.name}`}
                      style={{
                        padding: "8px 4px", borderRadius: 12,
                        border: done ? `2px solid ${C.quickWin}` : cur ? `2px solid ${C.accent}` : `1px solid ${C.border}`,
                        background: done ? C.quickWin : cur ? C.deepWorkLight : "#FAFAFA",
                        cursor: "pointer", display: "flex", flexDirection: "column", alignItems: "center", justifyContent: "center",
                        gap: 3, transition: "all 0.3s",
                        animation: cur && !done ? "glow 2s infinite" : "none",
                        minHeight: 52,
                      }}
                    >
                      {done ? (
                        <svg width="20" height="20" viewBox="0 0 16 16" fill="none">
                          <path d="M3 8.5L6.5 12L13 4" stroke="#fff" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"/>
                        </svg>
                      ) : cur ? (
                        <div style={{ width: 14, height: 14, borderRadius: "50%", background: C.accent, animation: "pulse 1.5s infinite" }} />
                      ) : (
                        <span style={{ color: "#CCC", fontWeight: 700, fontSize: 14 }}>{p.id}</span>
                      )}
                      <span style={{ fontSize: 7, fontWeight: 600, color: done ? "#fff" : cur ? C.accent : "#BBB", whiteSpace: "nowrap", overflow: "hidden", textOverflow: "ellipsis", maxWidth: "100%" }}>
                        {p.name}
                      </span>
                    </button>
                  );
                })}
              </div>

              {/* Treasure Map */}
              <div style={{ position: "relative", height: 120, overflow: "hidden", borderRadius: 12, background: "linear-gradient(135deg, #FFF9F2 0%, #FFF5EC 50%, #F9F1E8 100%)", flex: 1, minHeight: 110 }}>
                <svg width="100%" height="120" viewBox="0 0 500 120" preserveAspectRatio="xMidYMid meet" style={{ position: "absolute", top: 0, left: 0 }}>
                  <path d="M 25 70 Q 60 30, 95 60 Q 130 90, 170 48 Q 210 12, 250 60 Q 290 105, 335 45 Q 365 18, 400 58 Q 430 90, 460 40 Q 475 25, 480 35" fill="none" stroke="#E8D5C0" strokeWidth="3" strokeDasharray="6 4" strokeLinecap="round" />
                  <path d="M 25 70 Q 60 30, 95 60 Q 130 90, 170 48 Q 210 12, 250 60 Q 290 105, 335 45 Q 365 18, 400 58 Q 430 90, 460 40 Q 475 25, 480 35" fill="none" stroke={C.quickWin} strokeWidth="3.5" strokeLinecap="round" strokeDasharray={`${(state.currentPhase / 7) * 520} 520`} style={{ transition: "stroke-dasharray 1.5s ease" }} opacity="0.75" />
                  {[
                    { x: 25, y: 70 }, { x: 95, y: 60 }, { x: 170, y: 48 }, { x: 250, y: 60 },
                    { x: 335, y: 45 }, { x: 400, y: 58 }, { x: 460, y: 40 }, { x: 480, y: 35 },
                  ].map((pos, i) => {
                    const done = state.phasesCompleted.includes(i);
                    const cur = state.currentPhase === i;
                    return (
                      <g key={i}>
                        <circle cx={pos.x} cy={pos.y} r={done ? 10 : cur ? 11 : 7} fill={done ? C.quickWin : cur ? "#fff" : "#F0E6DE"} stroke={done ? C.quickWin : cur ? C.accent : "#E0D5CA"} strokeWidth={cur ? 3 : done ? 0 : 1.5} style={{ transition: "all 0.5s" }} />
                        {done && <path d={`M ${pos.x - 4} ${pos.y} L ${pos.x - 1} ${pos.y + 3} L ${pos.x + 4} ${pos.y - 3}`} fill="none" stroke="#fff" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" />}
                        {cur && (
                          <>
                            <circle cx={pos.x} cy={pos.y} r="16" fill="none" stroke={C.accent} strokeWidth="1.5" opacity="0.3">
                              <animate attributeName="r" from="11" to="22" dur="1.5s" repeatCount="indefinite" />
                              <animate attributeName="opacity" from="0.4" to="0" dur="1.5s" repeatCount="indefinite" />
                            </circle>
                            <circle cx={pos.x} cy={pos.y} r="5" fill={C.accent} />
                          </>
                        )}
                        <text x={pos.x} y={pos.y + (done || cur ? 24 : 20)} textAnchor="middle" fontSize="9" fill={done ? C.quickWin : cur ? C.accent : "#CCC"} fontWeight={cur ? "700" : "400"} fontFamily="system-ui">{i}</text>
                      </g>
                    );
                  })}
                  {(() => {
                    const positions = [{ x: 25, y: 70 }, { x: 95, y: 60 }, { x: 170, y: 48 }, { x: 250, y: 60 }, { x: 335, y: 45 }, { x: 400, y: 58 }, { x: 460, y: 40 }, { x: 480, y: 35 }];
                    const pos = positions[Math.min(state.currentPhase, 7)];
                    return <text x={pos.x} y={pos.y - 20} textAnchor="middle" fontSize="22" style={{ transition: "all 1s cubic-bezier(0.34,1.56,0.64,1)" }}>üöÄ</text>;
                  })()}
                  <text x="480" y="15" textAnchor="middle" fontSize="20">üèÜ</text>
                  <text x="25" y="50" textAnchor="middle" fontSize="14">üèÅ</text>
                </svg>
              </div>
            </div>
          </div>

          {/* Trophy Shelf */}
          <div style={{
            background: "linear-gradient(145deg, #1A1612 0%, #2C2218 50%, #1A1612 100%)",
            borderRadius: 16, padding: "14px 16px", marginBottom: 14,
            border: "1px solid #3D3228", position: "relative", overflow: "hidden",
          }}>
            <div style={{ position: "absolute", top: 0, left: 0, right: 0, bottom: 0, background: "radial-gradient(ellipse at 30% 20%, rgba(212,160,23,0.08) 0%, transparent 60%)", pointerEvents: "none" }} />
            <div style={{ display: "flex", alignItems: "center", gap: 8, marginBottom: 10, position: "relative" }}>
              <span style={{ fontSize: 16 }}>üèÜ</span>
              <div style={{ fontSize: 12, fontWeight: 800, color: "#D4A017", letterSpacing: 1.5, textTransform: "uppercase" }}>–°–ø–µ—á–µ–ª–µ–Ω–∏ –æ—Ç–ª–∏—á–∏—è</div>
              <div style={{ fontSize: 10, color: "rgba(255,255,255,0.3)", marginLeft: "auto" }}>{state.phasesCompleted.length} / {PHASES.length}</div>
            </div>
            <div className="trophy-grid" style={{ display: "grid", gridTemplateColumns: "repeat(8, 1fr)", gap: 6, position: "relative" }}>
              {PHASES.map(p => {
                const done = state.phasesCompleted.includes(p.id);
                return (
                  <div key={p.id} style={{
                    display: "flex", flexDirection: "column", alignItems: "center", gap: 4,
                    padding: "8px 4px", borderRadius: 10,
                    background: done ? "rgba(212,160,23,0.1)" : "rgba(255,255,255,0.02)",
                    border: done ? "1px solid rgba(212,160,23,0.25)" : "1px solid rgba(255,255,255,0.05)",
                    transition: "all 0.5s",
                  }}>
                    <div style={{ fontSize: 22, filter: done ? "none" : "grayscale(1) opacity(0.15)", transition: "all 0.5s" }}>{p.badge}</div>
                    <div style={{ fontSize: 9, fontWeight: 700, color: done ? "#E8C547" : "rgba(255,255,255,0.2)" }}>{p.id}</div>
                    <div style={{ fontSize: 8, color: done ? "rgba(255,255,255,0.55)" : "rgba(255,255,255,0.1)", lineHeight: 1.2, textAlign: "center" }}>{p.badgeText}</div>
                  </div>
                );
              })}
            </div>

            {state.phasesCompleted.length < PHASES.length && state.phasesCompleted.length > 0 && (
              <div style={{ marginTop: 8, paddingTop: 8, borderTop: "1px solid rgba(255,255,255,0.06)", position: "relative", display: "flex", alignItems: "center", gap: 10 }}>
                <span style={{ fontSize: 10, color: "rgba(255,255,255,0.3)", whiteSpace: "nowrap" }}>‚Üí {PHASES[state.currentPhase]?.badgeText}</span>
                <div style={{ flex: 1, height: 3, backgroundColor: "rgba(255,255,255,0.06)", borderRadius: 2, overflow: "hidden" }}>
                  <div style={{ width: `${(state.phasesCompleted.length / PHASES.length) * 100}%`, height: "100%", borderRadius: 2, background: "linear-gradient(90deg, #D4A017, #E8C547)", transition: "width 1s ease" }} />
                </div>
                <span style={{ fontSize: 10, color: "#D4A017", fontWeight: 700 }}>{Math.round((state.phasesCompleted.length / PHASES.length) * 100)}%</span>
              </div>
            )}

            {/* Settings */}
            <div style={{ marginTop: 12, paddingTop: 12, borderTop: "1px solid rgba(255,255,255,0.08)", position: "relative" }}>
              <button onClick={() => setShowSettings(!showSettings)}
                style={{
                  width: "100%", background: showSettings ? "rgba(212,160,23,0.15)" : "rgba(255,255,255,0.04)",
                  border: showSettings ? "1px solid rgba(212,160,23,0.3)" : "1px solid rgba(255,255,255,0.08)",
                  color: showSettings ? "#E8C547" : "rgba(255,255,255,0.5)",
                  fontSize: 12, fontWeight: 600, cursor: "pointer",
                  padding: "9px 16px", borderRadius: 8, display: "flex", alignItems: "center", justifyContent: "center", gap: 8,
                }}>
                <span style={{ fontSize: 14 }}>‚öôÔ∏è</span>
                {showSettings ? "–ó–∞—Ç–≤–æ—Ä–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ ‚ñ≤" : "–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ –æ–±—è—Å–Ω–µ–Ω–∏—è ‚ñº"}
              </button>
            </div>

            {showSettings && (
              <div style={{ marginTop: 10, padding: 14, background: "rgba(255,255,255,0.03)", borderRadius: 10, border: "1px solid rgba(255,255,255,0.06)", animation: "slideUp 0.3s ease" }}>
                <div style={{ marginBottom: 16, padding: 12, background: "rgba(74,111,165,0.1)", borderRadius: 8, border: "1px solid rgba(74,111,165,0.2)" }}>
                  <div style={{ fontSize: 12, fontWeight: 700, color: "#8BB4E0", marginBottom: 8 }}>üìñ –ö–∞–∫ —Ä–∞–±–æ—Ç–∏?</div>
                  <div style={{ fontSize: 11, color: "rgba(255,255,255,0.6)", lineHeight: 1.6, marginBottom: 8 }}>
                    <span style={{ fontWeight: 700, color: "rgba(255,255,255,0.8)" }}>üîÆ –°–µ–¥–º–∏—á–µ–Ω Check-in</span> ‚Äî –í—Å–µ–∫–∏ –ø–µ—Ç—ä–∫ –æ—Ç–≤–æ—Ä–∏ Notion ‚Üí –≤–∏–∂ –∫–æ–ª–∫–æ –∑–∞–¥–∞—á–∏ –æ—Ç –≤—Å—è–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—è —Å–∞ Done ‚Üí –≤—ä–≤–µ–¥–∏ –±—Ä–æ–π–∫–∏—Ç–µ ‚Üí –Ω–∞—Ç–∏—Å–Ω–∏ "–ó–∞—Ç–≤–æ—Ä–∏ —Å–µ–¥–º–∏—Ü–∞—Ç–∞". –ß–∞—Å–æ–≤–µ—Ç–µ —Å–µ –∫–∞–ª–∫—É–ª–∏—Ä–∞—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ: Deep Work = √ó2—á, Quick Win = √ó0.5—á, Learn = √ó1—á.
                  </div>
                  <div style={{ fontSize: 11, color: "rgba(255,255,255,0.6)", lineHeight: 1.6, marginBottom: 8 }}>
                    <span style={{ fontWeight: 700, color: "rgba(255,255,255,0.8)" }}>üå± –ù–∏–≤–æ</span> ‚Äî –†–∞—Å—Ç–µ —Å Deep Work –∑–∞–¥–∞—á–∏. –í—Å–µ–∫–∏ Deep Work = +1 —Ç–æ—á–∫–∞.
                  </div>
                  <div style={{ fontSize: 11, color: "rgba(255,255,255,0.6)", lineHeight: 1.6, marginBottom: 8 }}>
                    <span style={{ fontWeight: 700, color: "rgba(255,255,255,0.8)" }}>üî• Streak</span> ‚Äî –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ +1 –ø—Ä–∏ –≤—Å–µ–∫–∏ check-in. –†—ä—á–Ω–æ –Ω—É–ª–∏—Ä–∞–Ω–µ –∞–∫–æ –ø—Ä–æ–ø—É—Å–Ω–µ—à —Å–µ–¥–º–∏—Ü–∞.
                  </div>
                  <div style={{ fontSize: 11, color: "rgba(255,255,255,0.6)", lineHeight: 1.6 }}>
                    <span style={{ fontWeight: 700, color: "rgba(255,255,255,0.8)" }}>üìÖ –î–µ–Ω X / 90</span> ‚Äî –¢–µ—á–µ –æ—Ç –ø—ä—Ä–≤–∏—è check-in.
                  </div>
                </div>
                <div style={{ marginBottom: 12 }}>
                  <label style={{ fontSize: 11, color: "rgba(255,255,255,0.4)", display: "block", marginBottom: 4 }}>üí∞ –ù—É–ª–∏—Ä–∞–π –ø—Ä–∏—Ö–æ–¥–∏</label>
                  <button onClick={() => { const ns = { ...state, revenue: 0 }; setState(ns); save(ns); }}
                    style={{ padding: "7px 14px", borderRadius: 7, border: "1px solid rgba(255,255,255,0.1)", background: "rgba(255,255,255,0.05)", fontSize: 11, cursor: "pointer", color: "rgba(255,255,255,0.6)" }}>
                    –ù—É–ª–∏—Ä–∞–π –Ω–∞ ‚Ç¨0
                  </button>
                </div>
                <div style={{ marginBottom: 12 }}>
                  <label style={{ fontSize: 11, color: "rgba(255,255,255,0.4)", display: "block", marginBottom: 3 }}>üî• Streak –∫–æ—Ä–µ–∫—Ü–∏—è (—Å–µ–¥–º–∏—Ü–∏)</label>
                  <div style={{ display: "flex", gap: 3, flexWrap: "wrap" }}>
                    {Array.from({ length: 14 }, (_, i) => (
                      <button key={i} onClick={() => { const ns = { ...state, streakWeeks: i }; setState(ns); save(ns); }}
                        style={{
                          width: 26, height: 26, borderRadius: 5,
                          border: state.streakWeeks === i ? "2px solid #D4A017" : "1px solid rgba(255,255,255,0.1)",
                          background: i <= state.streakWeeks && i > 0 ? "rgba(212,160,23,0.15)" : "rgba(255,255,255,0.03)",
                          color: i <= state.streakWeeks && i > 0 ? "#E8C547" : "rgba(255,255,255,0.3)",
                          fontSize: 10, fontWeight: 600, cursor: "pointer",
                        }}>{i}</button>
                    ))}
                  </div>
                </div>
                <div style={{ marginBottom: 12 }}>
                  <label style={{ fontSize: 11, color: "rgba(255,255,255,0.4)", display: "block", marginBottom: 4 }}>üìç –¢–µ–∫—É—â–∞ —Ñ–∞–∑–∞</label>
                  <div style={{ display: "flex", gap: 3, flexWrap: "wrap" }}>
                    {PHASES.map(p => (
                      <button key={p.id} onClick={() => { const ns = { ...state, currentPhase: p.id }; setState(ns); save(ns); }}
                        style={{
                          padding: "3px 8px", borderRadius: 5,
                          border: state.currentPhase === p.id ? "2px solid #D4A017" : "1px solid rgba(255,255,255,0.1)",
                          background: state.currentPhase === p.id ? "rgba(212,160,23,0.15)" : "rgba(255,255,255,0.03)",
                          color: state.currentPhase === p.id ? "#E8C547" : "rgba(255,255,255,0.3)",
                          fontSize: 10, cursor: "pointer",
                        }}>{p.id}</button>
                    ))}
                  </div>
                </div>
                <button onClick={handleReset}
                  style={{ width: "100%", padding: 9, borderRadius: 7, border: "1px solid rgba(220,60,60,0.3)", background: "rgba(220,60,60,0.08)", color: "#E06060", fontSize: 11, cursor: "pointer", fontWeight: 600 }}>
                  üóë –ù—É–ª–∏—Ä–∞–π –≤—Å–∏—á–∫–æ
                </button>
              </div>
            )}
          </div>
        </div>
      )}
    </div>
  );
}

ReactDOM.createRoot(document.getElementById('root')).render(React.createElement(CALMDashboard));
  </script>
</body>
</html>
