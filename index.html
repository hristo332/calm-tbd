<!DOCTYPE html>
<html lang="bg">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>C.A.L.M. √ó TBD‚Ñ¢ ‚Äî 90-Day Roadmap</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  html, body, #root { height: 100%; overflow: hidden; }
  body { font-family: 'Segoe UI', -apple-system, system-ui, sans-serif; }
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const { useState, useEffect, useCallback, useRef, useMemo } = React;

// localStorage wrapper matching window.storage API
window.storage = {
  get: async function(key) {
    try {
      var val = localStorage.getItem(key);
      return val !== null ? { key: key, value: val } : null;
    } catch(e) { return null; }
  },
  set: async function(key, value) {
    try {
      localStorage.setItem(key, value);
      return { key: key, value: value };
    } catch(e) { return null; }
  },
  delete: async function(key) {
    try {
      localStorage.removeItem(key);
      return { key: key, deleted: true };
    } catch(e) { return null; }
  }
};


const PHASES=[{id:0,name:"–°—Ç–∞—Ä—Ç",badge:"üèÖ",badgeText:"–°–∏—Å—Ç–µ–º–∞—Ç–∞ —Ä–∞–±–æ—Ç–∏"},{id:1,name:"–ò–¥–µ–∞–ª–µ–Ω –∫–ª–∏–µ–Ω—Ç",badge:"üèÖ",badgeText:"–ó–Ω–∞–µ—à –ö–û–ô"},{id:2,name:"–û—Ñ–µ—Ä—Ç–∞",badge:"üèÖ",badgeText:"–û—Ñ–µ—Ä—Ç–∞—Ç–∞ –µ –Ω–µ—É—Å—Ç–æ–∏–º–∞"},{id:3,name:"–ù–æ–≤–∏ –∫–ª–∏–µ–Ω—Ç–∏",badge:"üèÖ",badgeText:"–ö–ª–∏–µ–Ω—Ç–∏—Ç–µ –∏–¥–≤–∞—Ç"},{id:4,name:"–°—ä–¥—ä—Ä–∂–∞–Ω–∏–µ",badge:"üèÖ",badgeText:"–°—ä–¥—ä—Ä–∂–∞–Ω–∏–µ—Ç–æ —Ä–∞–±–æ—Ç–∏"},{id:5,name:"–ü—Ä–æ–¥–∞–∂–±–∏",badge:"üèÖ",badgeText:"–ü—Ä–æ–¥–∞–∂–±–∏—Ç–µ —Ç–µ–∫–∞—Ç"},{id:6,name:"Delivery",badge:"üèÖ",badgeText:"Delivery –º–∞—à–∏–Ω–∞"},{id:7,name:"–ò–∑–º–µ—Ä–≤–∞–Ω–µ",badge:"üèÖ",badgeText:"–ò–∑–º–µ—Ä–≤–∞—à –∫–∞—Ç–æ –ø—Ä–æ"}];
const LEVELS=[{min:0,emoji:"üå±",name:"–ù–∞—á–∏–Ω–∞–µ—â",color:"#8B9467"},{min:2,emoji:"üåø",name:"–†–∞—Å—Ç—è—â",color:"#5B8C5A"},{min:5,emoji:"üå≥",name:"–°—Ç–∞–±–∏–ª–µ–Ω",color:"#2D6A4F"},{min:9,emoji:"üöÄ",name:"–ò–∑—Å—Ç—Ä–µ–ª—è–≤–∞—â —Å–µ",color:"#E76F51"},{min:14,emoji:"üíé",name:"–î–∏–∞–º–∞–Ω—Ç",color:"#9B5DE5"}];
const REVENUE_MILESTONES=[1000,2000,3000,4000,5000];
const HOURS_PER={deep:2,quick:0.5,learn:1};
const PHASE_WEEKS=[{phase:0,name:"–°—Ç–∞—Ä—Ç",startWeek:0,endWeek:0,color:"#8B9467"},{phase:1,name:"–ö–æ–π –µ –∫–ª–∏–µ–Ω—Ç—ä—Ç",startWeek:1,endWeek:2,color:"#5B8C5A"},{phase:2,name:"–û—Ñ–µ—Ä—Ç–∞",startWeek:3,endWeek:4,color:"#2D6A4F"},{phase:3,name:"–ö–ª–∏–µ–Ω—Ç–∏",startWeek:5,endWeek:6,color:"#E76F51"},{phase:4,name:"–°—ä–¥—ä—Ä–∂–∞–Ω–∏–µ",startWeek:7,endWeek:8,color:"#E8813A"},{phase:5,name:"–ü—Ä–æ–¥–∞–∂–±–∏",startWeek:9,endWeek:10,color:"#D4A017"},{phase:6,name:"Delivery",startWeek:11,endWeek:11,color:"#4A90D9"},{phase:7,name:"–ò–∑–º–µ—Ä–≤–∞–Ω–µ",startWeek:12,endWeek:12,color:"#9B5DE5"}];
const C={bg:"#FFF5EE",bgCard:"#FFFFFF",deepWork:"#E8813A",deepWorkLight:"#FFF4EC",deepWorkBorder:"#F5DCC8",quickWin:"#5BBD72",quickWinLight:"#F0FAF2",quickWinBorder:"#C8E8CF",learn:"#4A90D9",learnLight:"#EDF4FC",learnBorder:"#C4D9F0",border:"#F0E6DE",textPrimary:"#1A1A1A",textSecondary:"#666666",textMuted:"#999999",gold:"#D4A017",goldLight:"#FFF8E7",accent:"#E8813A",ritual:"#6C5CE7",ritualLight:"#F3F0FF",ritualBorder:"#D5CFF5"};

var Au={ctx:null,getCtx:function(){if(!this.ctx||this.ctx.state==="closed")this.ctx=new(window.AudioContext||window.webkitAudioContext)();if(this.ctx.state==="suspended")this.ctx.resume();return this.ctx},play:function(f,t,g,v,d){t=t||"sine";g=g||.08;v=v||.25;d=d||.3;try{var c=this.getCtx(),n=c.currentTime;f.forEach(function(fr,i){var o=c.createOscillator(),gn=c.createGain();o.type=t;o.frequency.setValueAtTime(fr,n+i*g);gn.gain.setValueAtTime(v,n+i*g);gn.gain.exponentialRampToValueAtTime(.01,n+i*g+d);o.connect(gn).connect(c.destination);o.start(n+i*g);o.stop(n+i*g+d+.05)})}catch(e){}},ritual:function(){this.play([261,329,392,523],"sine",.05,.15,1.5);var self=this;setTimeout(function(){self.play([784,880,1047,1318,1568,1760],"sine",.08,.12,.6)},400)},start:function(){this.play([440,554,659],"sine",.1,.2,.3)},end:function(){this.play([784,988,1175,1568],"sine",.15,.25,.8)},levelUp:function(){this.play([262,330,392,523,659,784,1047],"sine",.1,.18,.5)},revenue:function(){try{var c=this.getCtx(),n=c.currentTime,o=c.createOscillator(),g=c.createGain();o.type="square";o.frequency.setValueAtTime(800,n);o.frequency.setValueAtTime(1200,n+.05);g.gain.setValueAtTime(.12,n);g.gain.exponentialRampToValueAtTime(.01,n+.2);o.connect(g).connect(c.destination);o.start(n);o.stop(n+.25)}catch(e){}},bell:function(){try{var c=this.getCtx(),n=c.currentTime,o=c.createOscillator(),g=c.createGain();o.type="sine";o.frequency.setValueAtTime(528,n);g.gain.setValueAtTime(.15,n);g.gain.exponentialRampToValueAtTime(.001,n+1.2);o.connect(g).connect(c.destination);o.start(n);o.stop(n+1.3)}catch(e){}},_bn:null,breath:function(tp){this.stopB();try{var c=this.getCtx(),bs=2*c.sampleRate,nb=c.createBuffer(1,bs,c.sampleRate),o=nb.getChannelData(0);for(var i=0;i<bs;i++)o[i]=Math.random()*2-1;var n=c.createBufferSource();n.buffer=nb;n.loop=true;var f=c.createBiquadFilter();f.type="bandpass";f.frequency.setValueAtTime(tp==="inhale"?800:500,c.currentTime);f.Q.setValueAtTime(.8,c.currentTime);var g=c.createGain(),ct=c.currentTime;if(tp==="inhale"){g.gain.setValueAtTime(0,ct);g.gain.linearRampToValueAtTime(.06,ct+2)}else{g.gain.setValueAtTime(.06,ct);g.gain.linearRampToValueAtTime(0,ct+4)}n.connect(f).connect(g).connect(c.destination);n.start();this._bn=n}catch(e){}},stopB:function(){try{if(this._bn){this._bn.stop();this._bn.disconnect()}}catch(e){}this._bn=null}};

function useParticles(){var ps=useState([]),p=ps[0],sP=ps[1];var r=useRef([]),a=useRef(null);var launch=useCallback(function(type,int){type=type||"confetti";int=int||"medium";var cnt=int==="big"?(type==="money"?30:100):type==="money"?15:50;var cols=["#D4A017","#E8813A","#5BBD72","#4A90D9","#9B5DE5","#F7B731","#FC5C65","#45AAF2"];var me=["üí∞","üíµ","üí∂","ü™ô","üí≤","ü§ë"];var np=Array.from({length:cnt},function(_,i){return{id:Date.now()+i+Math.random(),type:type,x:window.innerWidth/2+(Math.random()-.5)*200,y:window.innerHeight*.4+Math.random()*100,vx:(Math.random()-.5)*(int==="big"?22:14),vy:-Math.random()*(int==="big"?22:16)-5,color:cols[Math.floor(Math.random()*cols.length)],emoji:me[Math.floor(Math.random()*me.length)],size:type==="money"?16+Math.random()*16:Math.random()*7+3,rotation:Math.random()*360,rs:(Math.random()-.5)*14,opacity:1,shape:Math.random()>.4?"rect":"circle"}});r.current=r.current.concat(np);sP(r.current.slice());if(!a.current){var tick=function(){r.current=r.current.map(function(p){return{id:p.id,type:p.type,x:p.x+p.vx,y:p.y+p.vy,vy:p.vy+.4,vx:p.vx*.99,color:p.color,emoji:p.emoji,size:p.size,rotation:p.rotation+p.rs,rs:p.rs,opacity:p.opacity-.01,shape:p.shape}}).filter(function(p){return p.opacity>0&&p.y<window.innerHeight+50});sP(r.current.slice());if(r.current.length>0)a.current=requestAnimationFrame(tick);else a.current=null};a.current=requestAnimationFrame(tick)}},[]);return{particles:p,launch:launch}}

function getWeekRange(d){var dt=new Date(d);var day=dt.getDay();var diff=dt.getDate()-day+(day===0?-6:1);var mon=new Date(dt.setDate(diff));mon.setHours(0,0,0,0);var sun=new Date(mon);sun.setDate(mon.getDate()+6);return{start:mon,end:sun}}
function formatDate(d){return String(d.getDate()).padStart(2,"0")+"."+String(d.getMonth()+1).padStart(2,"0")}
function weekKey(d){var s=getWeekRange(d).start;return s.getFullYear()+"-W"+String(s.getMonth()+1).padStart(2,"0")+"-"+String(s.getDate()).padStart(2,"0")}
function getLevel(dw){var l=LEVELS[0];for(var i=0;i<LEVELS.length;i++)if(dw>=LEVELS[i].min)l=LEVELS[i];return l}

function DonutChart(props){
  var dH=props.deepHours,qH=props.quickHours,lH=props.learnHours,size=props.size||195,vm=props.viewMode||"week";
  var total=dH+qH+lH,sw=Math.max(12,size*.14),r=size/2-sw/2-2,cx=size/2,cy=size/2,circ=2*Math.PI*r,mf=Math.max(18,size*.18),sf=Math.max(10,size*.08);
  if(total===0)return(<svg width={size} height={size} viewBox={"0 0 "+size+" "+size}><circle cx={cx} cy={cy} r={r} fill="none" stroke="#F0E6DE" strokeWidth={sw}/><text x={cx} y={cy-4} textAnchor="middle" fill="#999" fontSize={sf+2} fontFamily="system-ui">–ù—è–º–∞ –¥–∞–Ω–Ω–∏</text><text x={cx} y={cy+14} textAnchor="middle" fill="#CCC" fontSize={sf} fontFamily="system-ui">{vm==="journey"?"–∑–∞ 90 –¥–Ω–∏":"–∑–∞ —Ç–∞–∑–∏ —Å–µ–¥–º–∏—Ü–∞"}</text></svg>);
  var segs=[{value:dH,color:C.deepWork},{value:qH,color:C.quickWin},{value:lH,color:C.learn}].filter(function(s){return s.value>0});var offset=circ*.25;var gap=segs.length>1?3:0;
  return(<svg width={size} height={size} viewBox={"0 0 "+size+" "+size}><circle cx={cx} cy={cy} r={r} fill="none" stroke="#F5EFEA" strokeWidth={sw}/>{segs.map(function(s,i){var len=circ*(s.value/total);var el=<circle key={i} cx={cx} cy={cy} r={r} fill="none" stroke={s.color} strokeWidth={sw} strokeDasharray={(len-gap)+" "+(circ-len+gap)} strokeDashoffset={offset} strokeLinecap="round" style={{transition:"stroke-dasharray 0.8s ease"}}/>;offset-=len;return el})}<text x={cx} y={cy+2} textAnchor="middle" fill={C.textPrimary} fontSize={mf} fontWeight="800" fontFamily="system-ui">{total.toFixed(1)}—á</text><text x={cx} y={cy+mf*.8} textAnchor="middle" fill={C.textMuted} fontSize={sf} fontFamily="system-ui">{vm==="journey"?"90 –¥–Ω–∏":"—Ç–∞–∑–∏ —Å–µ–¥–º–∏—Ü–∞"}</text></svg>);
}

function BarChart(props){
  var weeklyData=props.weeklyData,dayNumber=props.dayNumber;
  var maxH=Math.max.apply(null,weeklyData.map(function(d){return d.deep+d.quick+d.learn}).concat([1])),gridLines=4,maxLabel=Math.ceil(maxH);
  var completedWeeks=weeklyData.filter(function(d){return d.deep+d.quick+d.learn>0}).length;
  var getPhase=function(i){return PHASE_WEEKS.find(function(p){return i>=p.startWeek&&i<=p.endWeek})};
  var isPhaseStart=function(i){return PHASE_WEEKS.some(function(p){return p.startWeek===i})};
  return(
    <div style={{display:"flex",flexDirection:"column",width:"100%",height:"100%"}}>
      <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6,flexShrink:0}}>
        <div style={{display:"flex",alignItems:"center",gap:6}}><span style={{fontSize:14}}>üìä</span><span style={{fontSize:13,fontWeight:800,color:C.textPrimary}}>90-–¥–Ω–µ–≤–µ–Ω –Ω–∞–ø—Ä–µ–¥—ä–∫</span></div>
        <div style={{display:"flex",gap:10}}>{[{color:C.deepWork,label:"Deep Work"},{color:C.quickWin,label:"Quick Wins"},{color:C.learn,label:"Learn"}].map(function(l){return <div key={l.label} style={{display:"flex",alignItems:"center",gap:4}}><div style={{width:8,height:8,borderRadius:2,background:l.color}}/><span style={{fontSize:10,color:C.textMuted}}>{l.label}</span></div>})}</div>
      </div>
      <div style={{marginBottom:6,flexShrink:0}}>
        <div style={{display:"flex",alignItems:"center",gap:8,marginBottom:3}}>
          <div style={{flex:1,height:8,background:"#F0E6DE",borderRadius:4,overflow:"hidden"}}><div style={{height:"100%",borderRadius:4,background:"linear-gradient(90deg,"+C.accent+","+C.accent+"CC)",width:Math.min(100,(dayNumber/90)*100)+"%",transition:"width 1s ease"}}/></div>
          <span style={{fontSize:11,fontWeight:700,color:C.accent,whiteSpace:"nowrap"}}>–î–µ–Ω {dayNumber}/90</span>
        </div>
        <div style={{display:"flex",justifyContent:"space-between"}}><span style={{fontSize:9,color:C.textMuted}}>üèÅ –°—Ç–∞—Ä—Ç</span><span style={{fontSize:9,color:C.textMuted}}>{completedWeeks}/13 —Å–µ–¥–º–∏—Ü–∏</span><span style={{fontSize:9,color:C.textMuted}}>üèÜ –§–∏–Ω–∞–ª</span></div>
      </div>
      <div style={{flex:1,display:"flex",minHeight:0}}>
        <div style={{width:28,height:"100%",position:"relative",flexShrink:0}}>
          {Array.from({length:gridLines+1},function(_,i){var val=(maxLabel/gridLines)*(gridLines-i);return <div key={i} style={{position:"absolute",top:(i/gridLines)*100+"%",right:3,transform:"translateY(-50%)",fontSize:9,color:C.textMuted,fontWeight:500}}>{val.toFixed(val%1===0?0:1)}—á</div>})}
        </div>
        <div style={{flex:1,position:"relative",display:"flex",flexDirection:"column"}}>
          <div style={{flex:1,position:"relative",minHeight:0}}>
            <div style={{position:"absolute",inset:0}}>{Array.from({length:gridLines+1},function(_,i){return <div key={i} style={{position:"absolute",top:(i/gridLines)*100+"%",left:0,right:0,height:1,background:i===gridLines?C.border:C.border+"80"}}/>})}</div>
            <div style={{position:"absolute",inset:0,display:"flex",zIndex:0}}>{weeklyData.map(function(_,i){var ph=getPhase(i);var isS=isPhaseStart(i);return <div key={i} style={{flex:1,background:ph?ph.color+"06":"transparent",borderLeft:isS&&i>0?"1.5px dashed "+(ph?ph.color:"#DDD")+"44":"none"}}/>})}</div>
            <div style={{position:"absolute",inset:0,display:"flex",zIndex:1}}>{weeklyData.map(function(d,i){var tot=d.deep+d.quick+d.learn;var totalH=maxLabel>0?(tot/maxLabel)*100:0;var deepH=tot>0?(d.deep/tot)*totalH:0;var quickH=tot>0?(d.quick/tot)*totalH:0;var learnH=tot>0?(d.learn/tot)*totalH:0;return <div key={i} style={{flex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-end",padding:"0 1px",background:d.isCurrent?C.accent+"10":"transparent",borderRadius:"3px 3px 0 0",opacity:d.isFuture?.35:1}}>{tot>0&&<div style={{fontSize:11,fontWeight:700,color:C.textSecondary,marginBottom:1}}>{tot.toFixed(1)}</div>}<div style={{display:"flex",flexDirection:"column",width:"100%",maxWidth:44,borderRadius:"3px 3px 1px 1px",overflow:"hidden",height:totalH+"%"}}>{learnH>0&&<div style={{flex:learnH,minHeight:2,background:"linear-gradient(180deg,"+C.learn+","+C.learn+"CC)"}}/>}{quickH>0&&<div style={{flex:quickH,minHeight:2,background:"linear-gradient(180deg,"+C.quickWin+","+C.quickWin+"CC)"}}/>}{deepH>0&&<div style={{flex:deepH,minHeight:2,background:"linear-gradient(180deg,"+C.deepWork+","+C.deepWork+"CC)"}}/>}</div>{tot===0&&<div style={{width:"100%",maxWidth:44,height:2,background:d.isFuture?"#E8E0D855":"#E8E0D8"}}/>}</div>})}</div>
          </div>
          <div style={{display:"flex",marginTop:2,flexShrink:0}}>{weeklyData.map(function(d,i){return <div key={i} style={{flex:1,textAlign:"center",fontSize:11,fontWeight:d.isCurrent?800:500,color:d.isCurrent?C.accent:d.isFuture?"#CCC":C.textMuted,lineHeight:1.2}}>{d.label}{d.isCurrent&&<div style={{width:4,height:4,borderRadius:"50%",background:C.accent,margin:"1px auto 0"}}/>}</div>})}</div>
          <div style={{display:"flex",marginTop:1,flexShrink:0}}>{PHASE_WEEKS.map(function(p){return <div key={p.phase} style={{flex:p.endWeek-p.startWeek+1,textAlign:"center",paddingTop:2,borderTop:"2px solid "+p.color+"55"}}><span style={{fontSize:9,fontWeight:700,color:p.color,textTransform:"uppercase",letterSpacing:.2,display:"block"}}>{p.name}</span></div>})}</div>
        </div>
      </div>
    </div>
  );
}

function BoxBreathing(){
  var s=useState(false),active=s[0],setActive=s[1];var s2=useState(0),phase=s2[0],setPhase=s2[1];var s3=useState(4),count=s3[0],setCount=s3[1];var s4=useState(0),cycle=s4[0],setCycle=s4[1];
  var intRef=useRef(null),pR=useRef(0),cR=useRef(4),cyR=useRef(0);
  var BL=["–í–¥–∏—à–∞–π...","–ó–∞–¥—Ä—ä–∂...","–ò–∑–¥–∏—à–∞–π...","–ó–∞–¥—Ä—ä–∂..."];
  var stop=useCallback(function(){if(intRef.current)clearInterval(intRef.current);intRef.current=null;setActive(false);setPhase(0);setCount(4);setCycle(0);pR.current=0;cR.current=4;cyR.current=0;Au.stopB()},[]);
  var start=useCallback(function(){setActive(true);pR.current=0;cR.current=4;cyR.current=0;setPhase(0);setCount(4);setCycle(0);Au.bell();Au.breath("inhale");intRef.current=setInterval(function(){cR.current--;if(cR.current<=0){pR.current=(pR.current+1)%4;cR.current=4;if(pR.current===0){cyR.current++;if(cyR.current>=4){stop();return}Au.bell();Au.breath("inhale")}else if(pR.current===2)Au.breath("exhale");else Au.stopB()}setPhase(pR.current);setCount(cR.current);setCycle(cyR.current)},1000)},[stop]);
  useEffect(function(){return function(){if(intRef.current)clearInterval(intRef.current);Au.stopB()}},[]);
  var lungScale=active?phase===0?.7+.3*((4-count)/4):phase===1?1:phase===2?1-.3*((4-count)/4):.7:.85;
  var circleScale=active?phase===0?.85+.15*((4-count)/4):phase===1?1:phase===2?1-.15*((4-count)/4):.85:.92;
  var bC=active?"#5BA8D9":"#A8D0E8";
  return(
    <div style={{background:C.bgCard,borderRadius:14,padding:12,border:"1px solid "+C.border,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:active?"default":"pointer",height:"100%"}} onClick={!active?start:undefined}>
      <div style={{fontSize:13,fontWeight:700,color:C.textPrimary,marginBottom:8}}>Box Breathing</div>
      <div style={{position:"relative",width:120,height:120,marginBottom:6}}>
        <div style={{position:"absolute",top:"50%",left:"50%",width:110,height:110,transform:"translate(-50%,-50%) scale("+circleScale+")",transition:"transform .9s ease-in-out",borderRadius:"50%",border:"2px solid "+bC}}/>
        <div style={{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%,-44%) scale("+lungScale+")",transition:"transform .9s ease-in-out",width:48,height:54}}>
          <svg viewBox="0 0 50 56" width="48" height="54" fill="none"><path d="M 25 2 L 25 18" stroke={bC} strokeWidth="2.5" strokeLinecap="round"/><path d="M 25 18 Q 22 22, 18 24" stroke={bC} strokeWidth="2" strokeLinecap="round"/><path d="M 25 18 Q 28 22, 32 24" stroke={bC} strokeWidth="2" strokeLinecap="round"/><path d="M 18 24 Q 8 26, 6 36 Q 4 46, 14 50 Q 20 52, 23 44 Q 24 38, 23 30 Q 22 26, 18 24 Z" fill={bC} opacity=".2" stroke={bC} strokeWidth="1.5"/><path d="M 32 24 Q 42 26, 44 36 Q 46 46, 36 50 Q 30 52, 27 44 Q 26 38, 27 30 Q 28 26, 32 24 Z" fill={bC} opacity=".2" stroke={bC} strokeWidth="1.5"/></svg>
        </div>
        {active&&<div style={{position:"absolute",top:8,left:"50%",transform:"translateX(-50%)",fontSize:18,fontWeight:900,color:bC,zIndex:2}}>{count}</div>}
      </div>
      {active?(<><div style={{fontSize:13,fontWeight:700,color:bC,marginBottom:4}}>{BL[phase]}</div><div style={{display:"flex",gap:5,marginBottom:6}}>{[0,1,2,3].map(function(i){return <div key={i} style={{width:7,height:7,borderRadius:"50%",background:i<cycle?C.quickWin:i===cycle?bC:"#E0D5CA"}}/>})}</div><button onClick={function(e){e.stopPropagation();stop()}} style={{padding:"5px 16px",borderRadius:16,border:"none",background:"#F5E6E6",color:"#C44",fontSize:11,fontWeight:700,cursor:"pointer"}}>–°—Ç–æ–ø</button></>):(<><div style={{fontSize:12,color:C.textMuted,marginBottom:2}}>–ö–ª–∏–∫–Ω–∏ –∑–∞ —Å—Ç–∞—Ä—Ç</div><div style={{fontSize:18,fontWeight:800,color:bC}}>4-4-4-4</div></>)}
    </div>
  );
}

function PomodoroTimer(props){
  var onReset=props.onReset,isDemo=props.isDemo;
  var s1=useState(null),mode=s1[0],setMode=s1[1];var s2=useState(false),running=s2[0],setRunning=s2[1];var s3=useState(0),secLeft=s3[0],setSecLeft=s3[1];var s4=useState(0),totalSec=s4[0],setTotalSec=s4[1];var intRef=useRef(null),endRef=useRef(null);
  var M={deep:{dur:120*60,label:"Deep Work",emoji:"üèîÔ∏è",color:C.deepWork,bg:C.deepWorkLight,bc:C.deepWorkBorder,mins:"2 —á–∞—Å–∞"},quick:{dur:30*60,label:"Quick Win",emoji:"‚ö°",color:C.quickWin,bg:C.quickWinLight,bc:C.quickWinBorder,mins:"30 –º–∏–Ω"},learn:{dur:60*60,label:"Learn",emoji:"üìö",color:C.learn,bg:C.learnLight,bc:C.learnBorder,mins:"1 —á–∞—Å"}};
  var fmt=function(s){var h=Math.floor(s/3600),m=Math.floor((s%3600)/60),sc=s%60;return h>0?h+":"+String(m).padStart(2,"0")+":"+String(sc).padStart(2,"0"):String(m).padStart(2,"0")+":"+String(sc).padStart(2,"0")};
  var startT=function(m){setMode(m);var d=M[m].dur;setTotalSec(d);setSecLeft(d);setRunning(true);endRef.current=Date.now()+d*1000;Au.start()};
  var stopT=function(){if(intRef.current)clearInterval(intRef.current);intRef.current=null;setRunning(false);setMode(null);setSecLeft(0)};
  var pauseT=function(){if(intRef.current)clearInterval(intRef.current);intRef.current=null;setRunning(false)};
  var resumeT=function(){if(!mode||secLeft<=0)return;setRunning(true);endRef.current=Date.now()+secLeft*1000;Au.start()};
  useEffect(function(){if(!running||!mode)return;intRef.current=setInterval(function(){var r=Math.max(0,Math.round((endRef.current-Date.now())/1000));setSecLeft(r);if(r<=0){clearInterval(intRef.current);intRef.current=null;setRunning(false);Au.end()}},250);return function(){if(intRef.current)clearInterval(intRef.current)}},[running,mode]);
  var pct=totalSec>0?((totalSec-secLeft)/totalSec)*100:0,cm=mode?M[mode]:null,isDone=mode&&!running&&secLeft<=0;
  if(!mode)return(<div style={{background:C.bgCard,borderRadius:16,padding:"14px 20px",border:"1px solid "+C.border}}><div style={{display:"flex",alignItems:"center",justifyContent:"space-between"}}><div style={{display:"flex",alignItems:"center",gap:10}}><span style={{fontSize:36}}>üçÖ</span><div><div style={{fontSize:20,fontWeight:800,color:C.textPrimary}}>–ì–æ—Ç–æ–≤ –∑–∞ —Ä–∞–±–æ—Ç–∞?</div><div style={{fontSize:13,color:C.textMuted}}>–ò–∑–±–µ—Ä–∏ —Ç–∏–ø–∞ –∑–∞–¥–∞—á–∞ –∏ –Ω–∞—Ç–∏—Å–Ω–∏ —Å—Ç–∞—Ä—Ç</div></div></div><div style={{display:"flex",gap:6}}>{Object.entries(M).map(function(e){var k=e[0],m=e[1];return <button key={k} onClick={function(){startT(k)}} style={{padding:"10px 16px",borderRadius:12,border:"2px solid "+m.bc,background:m.bg,cursor:"pointer",display:"flex",alignItems:"center",gap:6}}><span style={{fontSize:16}}>{m.emoji}</span><div style={{textAlign:"left"}}><div style={{fontSize:12,fontWeight:800,color:m.color}}>{m.label}</div><div style={{fontSize:10,color:C.textMuted}}>{m.mins}</div></div></button>})}{isDemo&&<button onClick={onReset} style={{padding:"10px 16px",borderRadius:12,border:"2px solid #E8D0C0",background:"linear-gradient(135deg,#FFF5EE,#FFF0E8)",cursor:"pointer",display:"flex",alignItems:"center",gap:6}}><span style={{fontSize:16}}>üîÑ</span><div style={{textAlign:"left"}}><div style={{fontSize:12,fontWeight:800,color:"#C07030"}}>–ó–∞–Ω—É–ª–∏</div><div style={{fontSize:10,color:C.textMuted}}>–¥–µ–º–æ –¥–∞–Ω–Ω–∏</div></div></button>}</div></div></div>);
  return(<div style={{background:"linear-gradient(135deg,"+cm.bg+" 0%,"+C.bgCard+" 60%,"+cm.bg+" 100%)",borderRadius:16,padding:"14px 20px",border:"2px solid "+(isDone?C.quickWin+"55":cm.bc)}}><div style={{display:"flex",alignItems:"center",gap:16}}><div style={{position:"relative",width:70,height:70,flexShrink:0}}><svg width="70" height="70" viewBox="0 0 70 70"><circle cx="35" cy="35" r="29" fill="none" stroke={cm.color+"15"} strokeWidth="6"/><circle cx="35" cy="35" r="29" fill="none" stroke={isDone?C.quickWin:cm.color} strokeWidth="6" strokeDasharray={2*Math.PI*29} strokeDashoffset={2*Math.PI*29*(1-pct/100)} strokeLinecap="round" transform="rotate(-90 35 35)" style={{transition:"stroke-dashoffset .5s ease"}}/></svg><div style={{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%,-50%)"}}>{isDone?<div style={{fontSize:26}}>‚úÖ</div>:<div style={{fontSize:22}}>üçÖ</div>}</div></div><div style={{flex:1}}><div style={{display:"flex",alignItems:"baseline",gap:8,marginBottom:3}}><span style={{fontSize:13}}>{cm.emoji}</span><span style={{fontSize:13,fontWeight:700,color:cm.color}}>{cm.label}</span></div><div style={{fontSize:isDone?28:secLeft>=3600?36:40,fontWeight:900,color:isDone?C.quickWin:C.textPrimary,fontVariantNumeric:"tabular-nums",letterSpacing:-1,lineHeight:1}}>{isDone?"00:00":fmt(secLeft)}</div><div style={{width:"100%",height:4,background:cm.color+"15",borderRadius:2,marginTop:4,overflow:"hidden"}}><div style={{height:"100%",borderRadius:2,background:isDone?C.quickWin:"linear-gradient(90deg,"+cm.color+","+cm.color+"BB)",width:pct+"%",transition:"width .5s ease"}}/></div></div><div style={{display:"flex",gap:6,flexShrink:0}}>{isDone?<button onClick={stopT} style={{padding:"10px 20px",borderRadius:12,border:"none",background:"linear-gradient(135deg,"+cm.color+","+cm.color+"CC)",color:"#fff",fontSize:13,fontWeight:800,cursor:"pointer"}}>–ù–æ–≤–∞ —Å–µ—Å–∏—è</button>:running?<><button onClick={pauseT} style={{padding:"10px 16px",borderRadius:12,border:"2px solid "+cm.bc,background:cm.bg,color:cm.color,fontSize:16,fontWeight:700,cursor:"pointer"}}>‚è∏</button><button onClick={stopT} style={{padding:"10px 12px",borderRadius:12,border:"1px solid "+C.border,background:"#fff",color:C.textMuted,fontSize:13,cursor:"pointer"}}>‚úï</button></>:<><button onClick={resumeT} style={{padding:"10px 20px",borderRadius:12,border:"none",background:"linear-gradient(135deg,"+cm.color+","+cm.color+"CC)",color:"#fff",fontSize:13,fontWeight:800,cursor:"pointer"}}>‚ñ∂ –ü—Ä–æ–¥—ä–ª–∂–∏</button><button onClick={stopT} style={{padding:"10px 12px",borderRadius:12,border:"1px solid "+C.border,background:"#fff",color:C.textMuted,fontSize:13,cursor:"pointer"}}>‚úï</button></>}</div></div></div>);
}

function Stepper(props){
  var value=props.value,onChange=props.onChange,color=props.color,bg=props.bg,bc=props.bc,emoji=props.emoji,label=props.label,hpe=props.hpe;
  return(<div style={{flex:1,display:"flex",flexDirection:"column",alignItems:"center",gap:6,padding:"10px 6px",borderRadius:14,background:bg,border:"2px solid "+(value>0?color:bc)}}><div style={{fontSize:24}}>{emoji}</div><div style={{fontSize:11,fontWeight:700,color:color}}>{label}</div><div style={{display:"flex",alignItems:"center"}}><button onClick={function(){onChange(Math.max(0,value-1))}} style={{width:32,height:32,borderRadius:"50%",border:"2px solid "+bc,background:"#fff",fontSize:18,fontWeight:700,color:value>0?color:"#CCC",cursor:value>0?"pointer":"default",display:"flex",alignItems:"center",justifyContent:"center"}}>‚àí</button><div style={{minWidth:40,textAlign:"center",fontSize:28,fontWeight:900,color:value>0?C.textPrimary:"#CCC"}}>{value}</div><button onClick={function(){onChange(value+1)}} style={{width:32,height:32,borderRadius:"50%",border:"none",background:"linear-gradient(135deg,"+color+","+color+"DD)",fontSize:18,fontWeight:700,color:"#fff",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"}}>+</button></div><div style={{fontSize:13,fontWeight:700,color:value>0?color:"#CCC"}}>{(value*hpe).toFixed(value*hpe%1===0?0:1)}—á</div></div>);
}

function Celeb(props){var s=useState(true),v=s[0],setV=s[1];var m={weeklyRitual:{e:"üîÆ",t:"–°–ï–î–ú–ò–¶–ê–¢–ê –ó–ê–¢–í–û–†–ï–ù–ê!"},levelUp:{e:"‚¨ÜÔ∏è",t:"LEVEL UP!"},phaseComplete:{e:"üèÖ",t:"–§–ê–ó–ê –ó–ê–í–™–†–®–ï–ù–ê!"},revenue:{e:"üí∞",t:"MILESTONE!"}}[props.type]||{e:"‚ú®",t:"–ë–†–ê–í–û!"};useEffect(function(){var t=setTimeout(function(){setV(false);if(props.onDone)props.onDone()},2000);return function(){clearTimeout(t)}},[props.type,props.onDone]);if(!v)return null;return(<div style={{position:"fixed",inset:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"rgba(255,255,255,.9)",backdropFilter:"blur(6px)",zIndex:9998,animation:"popIn .3s cubic-bezier(.34,1.56,.64,1)"}}><div style={{fontSize:56}}>{m.e}</div><div style={{fontSize:22,fontWeight:900,color:C.textPrimary,marginTop:6}}>{m.t}</div></div>)}

function SettingsModal(props){
  var state=props.state,setState=props.setState,save=props.save,onClose=props.onClose;
  return(<div style={{position:"fixed",inset:0,background:"rgba(0,0,0,.4)",backdropFilter:"blur(6px)",zIndex:9990,display:"flex",alignItems:"center",justifyContent:"center"}} onClick={onClose}><div style={{background:C.bgCard,borderRadius:18,padding:20,width:"92%",maxWidth:400,boxShadow:"0 16px 50px rgba(0,0,0,.15)",animation:"popIn .3s cubic-bezier(.34,1.56,.64,1)"}} onClick={function(e){e.stopPropagation()}}>
    <div style={{display:"flex",justifyContent:"space-between",marginBottom:16}}><span style={{fontSize:16,fontWeight:800}}>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</span><button onClick={onClose} style={{width:30,height:30,borderRadius:8,border:"none",background:"#F5F5F5",fontSize:14,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"}}>‚úï</button></div>
    <div style={{display:"flex",flexDirection:"column",gap:12}}>
      <div><label style={{fontSize:11,color:C.textSecondary,fontWeight:600,display:"block",marginBottom:4}}>üî• Streak</label><div style={{display:"flex",gap:3,flexWrap:"wrap"}}>{Array.from({length:14},function(_,i){return <button key={i} onClick={function(){var ns=Object.assign({},state,{streakWeeks:i});setState(ns);save(ns)}} style={{width:26,height:26,borderRadius:6,border:state.streakWeeks===i?"2px solid #CA8A04":"none",background:i<=state.streakWeeks&&i>0?"#FEF3C7":"#F5F5F5",color:i<=state.streakWeeks&&i>0?"#92400E":C.textMuted,fontSize:10,fontWeight:700,cursor:"pointer"}}>{i}</button>})}</div></div>
      <div><label style={{fontSize:11,color:C.textSecondary,fontWeight:600,display:"block",marginBottom:4}}>üìç –§–∞–∑–∞</label><div style={{display:"flex",gap:3,flexWrap:"wrap"}}>{PHASES.map(function(p){return <button key={p.id} onClick={function(){var ns=Object.assign({},state,{currentPhase:p.id});setState(ns);save(ns)}} style={{padding:"3px 8px",borderRadius:5,border:state.currentPhase===p.id?"2px solid #CA8A04":"1px solid #EEE",background:state.currentPhase===p.id?"#FEF3C7":"#F5F5F5",fontSize:10,cursor:"pointer"}}>{p.id}</button>})}</div></div>
      <button onClick={function(){setState(EMPTY);save(EMPTY);onClose()}} style={{width:"100%",padding:10,borderRadius:8,border:"1px solid rgba(220,60,60,.3)",background:"rgba(220,60,60,.05)",color:"#E06060",fontSize:11,cursor:"pointer",fontWeight:600}}>üóë –ù—É–ª–∏—Ä–∞–π –≤—Å–∏—á–∫–æ</button>
    </div>
  </div></div>);
}

var EMPTY={deepWork:0,quickWins:0,currentPhase:0,phasesCompleted:[],revenue:0,revenueGoal:5000,streakWeeks:0,startDay:null,totalTasks:25,weeklyCheckins:{}};

function generateDemo(){
  var now=new Date();var checkins={};var startDate=new Date(now);startDate.setDate(startDate.getDate()-42);
  var weeks=[
    {deep:8,quick:14,learn:5},
    {deep:9,quick:16,learn:6},
    {deep:7,quick:18,learn:5},
    {deep:10,quick:14,learn:6},
    {deep:8,quick:16,learn:5},
    {deep:9,quick:12,learn:7}
  ];
  var totalDeep=0,totalQuick=0;
  for(var i=0;i<6;i++){var wd=new Date(startDate);wd.setDate(wd.getDate()+i*7);var k=weekKey(wd);checkins[k]={deep:weeks[i].deep,quick:weeks[i].quick,learn:weeks[i].learn,savedAt:wd.getTime()};totalDeep+=weeks[i].deep;totalQuick+=weeks[i].quick}
  var curWeek=weekKey(now);checkins[curWeek]={deep:6,quick:10,learn:4,savedAt:now.getTime()};totalDeep+=6;totalQuick+=10;
  return{deepWork:totalDeep,quickWins:totalQuick,currentPhase:3,phasesCompleted:[0,1,2],revenue:1200,revenueGoal:5000,streakWeeks:7,startDay:startDate.getTime(),totalTasks:25,weeklyCheckins:checkins,isDemo:true};
}

var DEFAULT=generateDemo();

function CALMDashboard(){
  var s0=useState(DEFAULT),state=s0[0],setState=s0[1];var s1=useState(new Date()),currentWeek=s1[0],setCurrentWeek=s1[1];var s2=useState(null),celebration=s2[0],setCelebration=s2[1];var s3=useState(false),showSettings=s3[0],setShowSettings=s3[1];var s4=useState(""),revenueInput=s4[0],setRevenueInput=s4[1];var s5=useState("week"),viewMode=s5[0],setViewMode=s5[1];var s6=useState(false),mounted=s6[0],setMounted=s6[1];var s7=useState("charts"),tab=s7[0],setTab=s7[1];var pp=useParticles(),particles=pp.particles,launch=pp.launch;
  var s8=useState(0),ciDeep=s8[0],setCiDeep=s8[1];var s9=useState(0),ciQuick=s9[0],setCiQuick=s9[1];var s10=useState(0),ciLearn=s10[0],setCiLearn=s10[1];var s11=useState(false),ciSaved=s11[0],setCiSaved=s11[1];

  useEffect(function(){setMounted(true);(async function(){try{var r=await window.storage.get("calm-v10");if(r&&r.value){var parsed=JSON.parse(r.value);if(parsed.weeklyCheckins&&Object.keys(parsed.weeklyCheckins).length>0){parsed.isDemo=false;setState(parsed)}}}catch(e){}})()},[]);
  var save=useCallback(async function(s){try{await window.storage.set("calm-v10",JSON.stringify(s))}catch(e){}},[]);
  var handleReset=useCallback(function(){var ns=Object.assign({},EMPTY);setState(ns);save(ns)},[save]);
  var wk=weekKey(currentWeek);var wr=getWeekRange(currentWeek);var weekStart=wr.start,weekEnd=wr.end;var isCurrentWeek=weekKey(new Date())===wk;
  useEffect(function(){var ci=state.weeklyCheckins[wk];if(ci){setCiDeep(ci.deep||0);setCiQuick(ci.quick||0);setCiLearn(ci.learn||0);setCiSaved(true)}else{setCiDeep(0);setCiQuick(0);setCiLearn(0);setCiSaved(false)}},[wk,state.weeklyCheckins]);
  var calcH=function(ci){return{deep:(ci&&ci.deep||0)*HOURS_PER.deep,quick:(ci&&ci.quick||0)*HOURS_PER.quick,learn:(ci&&ci.learn||0)*HOURS_PER.learn}};
  var weekHours=calcH(state.weeklyCheckins[wk]);var totalHours=weekHours.deep+weekHours.quick+weekHours.learn;
  var weeklyBarData=useMemo(function(){var ws=[];var sd=state.startDay?new Date(state.startDay):new Date();var js=getWeekRange(sd).start;for(var i=0;i<13;i++){var wd=new Date(js);wd.setDate(wd.getDate()+i*7);var k=weekKey(wd);var h=calcH(state.weeklyCheckins[k]);ws.push({label:"–°"+(i+1),deep:h.deep,quick:h.quick,learn:h.learn,isFuture:wd>new Date(),isCurrent:weekKey(new Date())===k})}return ws},[state.startDay,state.weeklyCheckins]);
  var cumTotals=useMemo(function(){var d=0,q=0,l=0;Object.values(state.weeklyCheckins).forEach(function(ci){var h=calcH(ci);d+=h.deep;q+=h.quick;l+=h.learn});return{deep:d,quick:q,learn:l,total:d+q+l}},[state.weeklyCheckins]);
  var pd=viewMode==="journey"?cumTotals:{deep:weekHours.deep,quick:weekHours.quick,learn:weekHours.learn,total:totalHours};
  var tD=pd.deep,tQ=pd.quick,tL=pd.learn,tP=pd.total;var dPct=tP>0?Math.round(tD/tP*100):0,qPct=tP>0?Math.round(tQ/tP*100):0,lPct=tP>0?100-dPct-qPct:0;
  var level=getLevel(state.deepWork);var dayNumber=state.startDay?Math.min(90,Math.floor((Date.now()-state.startDay)/864e5)+1):0;
  var navigateWeek=function(dir){var d=new Date(currentWeek);d.setDate(d.getDate()+dir*7);setCurrentWeek(d)};
  var previewDH=ciDeep*HOURS_PER.deep,previewQH=ciQuick*HOURS_PER.quick,previewLH=ciLearn*HOURS_PER.learn,previewTotal=previewDH+previewQH+previewLH,previewTasks=ciDeep+ciQuick+ciLearn;

  var handleSave=useCallback(function(){if(previewTasks===0)return;var newDW=state.deepWork+ciDeep;var nl=getLevel(newDW);var wasLU=nl.name!==level.name;var ns=Object.assign({},state,{deepWork:newDW,quickWins:state.quickWins+ciQuick,streakWeeks:state.streakWeeks+1,isDemo:false,weeklyCheckins:Object.assign({},state.weeklyCheckins)});ns.weeklyCheckins[wk]={deep:ciDeep,quick:ciQuick,learn:ciLearn,savedAt:Date.now()};if(!ns.startDay)ns.startDay=Date.now();setState(ns);save(ns);setCiSaved(true);Au.ritual();launch("confetti","big");setCelebration("weeklyRitual");if(wasLU)setTimeout(function(){setCelebration("levelUp");launch("confetti","big")},2800)},[ciDeep,ciQuick,ciLearn,state,level,wk,save,launch,previewTasks]);
  var handleUndo=useCallback(function(){var ci=state.weeklyCheckins[wk];if(!ci)return;var nc=Object.assign({},state.weeklyCheckins);delete nc[wk];var ns=Object.assign({},state,{deepWork:Math.max(0,state.deepWork-(ci.deep||0)),quickWins:Math.max(0,state.quickWins-(ci.quick||0)),streakWeeks:Math.max(0,state.streakWeeks-1),weeklyCheckins:nc});setState(ns);save(ns);setCiSaved(false);setCiDeep(0);setCiQuick(0);setCiLearn(0)},[state,wk,save]);
  var handlePhaseComplete=useCallback(function(pid){if(state.phasesCompleted.indexOf(pid)>=0){var nc=state.phasesCompleted.filter(function(id){return id!==pid});var ns=Object.assign({},state,{phasesCompleted:nc,currentPhase:(PHASES.find(function(p){return nc.indexOf(p.id)<0})||{id:0}).id});setState(ns);save(ns)}else{var nc2=state.phasesCompleted.concat([pid]);var ns2=Object.assign({},state,{phasesCompleted:nc2,currentPhase:(PHASES.find(function(p){return nc2.indexOf(p.id)<0})||{id:7}).id});setState(ns2);save(ns2);Au.levelUp();launch("confetti","big");setCelebration("phaseComplete")}},[state,save,launch]);
  var addRevenue=useCallback(function(amount){var nr=state.revenue+amount;var oldM=REVENUE_MILESTONES.filter(function(m){return state.revenue>=m}).length;var newM=REVENUE_MILESTONES.filter(function(m){return nr>=m}).length;var ns=Object.assign({},state,{revenue:nr});setState(ns);save(ns);Au.revenue();launch("money","normal");if(newM>oldM)setTimeout(function(){Au.levelUp();launch("confetti","big");setCelebration("revenue")},600)},[state,save,launch]);
  var handleRevenue=useCallback(function(){var val=parseFloat(revenueInput);if(isNaN(val)||val<=0)return;addRevenue(val);setRevenueInput("")},[revenueInput,addRevenue]);

  if(!mounted)return null;
  var TABS=[{id:"charts",label:"üìä –ì—Ä–∞—Ñ–∏–∫–∏"},{id:"ritual",label:ciSaved?"‚úÖ –†–∏—Ç—É–∞–ª":"üîÆ –†–∏—Ç—É–∞–ª"},{id:"revenue",label:"üí∞ –ü—Ä–∏—Ö–æ–¥–∏"}];

  return(
    <div style={{height:"100vh",background:C.bg,fontFamily:"'Segoe UI',-apple-system,system-ui,sans-serif",padding:"12px 16px",display:"flex",flexDirection:"column",overflow:"hidden"}}>
      <style>{"@keyframes popIn{0%{transform:scale(.3);opacity:0}50%{transform:scale(1.1)}100%{transform:scale(1);opacity:1}}@keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.03)}}@keyframes slideUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}@keyframes glow{0%,100%{box-shadow:0 0 6px rgba(232,129,58,.15)}50%{box-shadow:0 0 16px rgba(232,129,58,.35)}}*{box-sizing:border-box}"}</style>

      {particles.map(function(p){return p.type==="money"?<div key={p.id} style={{position:"fixed",left:p.x,top:p.y,fontSize:p.size,transform:"rotate("+p.rotation+"deg)",opacity:p.opacity,pointerEvents:"none",zIndex:9999}}>{p.emoji}</div>:<div key={p.id} style={{position:"fixed",left:p.x,top:p.y,width:p.shape==="circle"?p.size:p.size*.6,height:p.shape==="circle"?p.size:p.size*1.2,backgroundColor:p.color,borderRadius:p.shape==="circle"?"50%":2,transform:"rotate("+p.rotation+"deg)",opacity:p.opacity,pointerEvents:"none",zIndex:9999}}/>})}
      {celebration&&<Celeb type={celebration} onDone={function(){setCelebration(null)}}/>}
      {showSettings&&<SettingsModal state={state} setState={setState} save={save} onClose={function(){setShowSettings(false)}}/>}

      {/* POMODORO ‚Äî v1 sizes */}
      <div style={{flexShrink:0,marginBottom:10}}><PomodoroTimer isDemo={!!state.isDemo} onReset={handleReset}/></div>

      {/* DASHBOARD ‚Äî v1 sizes: big donut, big bars, level/streak/day in header */}
      <div style={{display:"grid",gridTemplateColumns:"1fr 190px",gap:10,marginBottom:10,flexShrink:0}}>
        <div style={{background:C.bgCard,borderRadius:16,padding:"12px 16px",border:"1px solid "+C.border}}>
          <div style={{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:10}}>
            <span style={{fontSize:13,fontWeight:800,color:C.textPrimary,textTransform:"uppercase",letterSpacing:.5}}>{viewMode==="journey"?"90-–î–ù–ï–í–ù–ê":"–°–ï–î–ú–ò–ß–ù–ê"} –ü–†–û–î–£–ö–¢–ò–í–ù–û–°–¢</span>
            <div style={{display:"flex",gap:3,alignItems:"center"}}>
              <div style={{display:"flex",gap:2,background:"#F5F5F5",borderRadius:8,padding:2}}>{[{key:"week",label:"–°–µ–¥–º–∏—Ü–∞"},{key:"journey",label:"90 –¥–Ω–∏"}].map(function(t){return <button key={t.key} onClick={function(){setViewMode(t.key)}} style={{padding:"3px 10px",borderRadius:6,border:"none",background:viewMode===t.key?C.accent:"transparent",color:viewMode===t.key?"#fff":C.textMuted,fontSize:11,fontWeight:viewMode===t.key?700:400,cursor:"pointer"}}>{t.label}</button>})}</div>
              <div style={{display:"flex",alignItems:"center",gap:3,padding:"3px 8px",borderRadius:14,background:level.color+"12",border:"1px solid "+level.color+"25"}}><span style={{fontSize:13}}>{level.emoji}</span><span style={{fontSize:11,fontWeight:700,color:level.color}}>{level.name}</span></div>
              <div style={{display:"flex",alignItems:"center",gap:3,padding:"3px 8px",borderRadius:14,background:state.streakWeeks>0?C.accent+"12":"#F5F5F5"}}><span style={{fontSize:12}}>{state.streakWeeks>0?"üî•":"üí§"}</span><span style={{fontSize:11,fontWeight:700,color:state.streakWeeks>0?C.accent:C.textMuted}}>{state.streakWeeks>0?state.streakWeeks+" —Å–µ–¥.":"0"}</span></div>
              <div><span style={{fontSize:11,color:C.textMuted}}>–î–µ–Ω </span><span style={{fontSize:18,fontWeight:900,color:C.textPrimary}}>{dayNumber}</span><span style={{fontSize:11,color:C.textMuted}}> / 90</span></div>
              <button onClick={function(){setShowSettings(true)}} style={{width:30,height:30,borderRadius:8,border:"1px solid "+C.border,background:C.bgCard,fontSize:14,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"}}>‚öôÔ∏è</button>
            </div>
          </div>
          <div style={{display:"flex",gap:16,alignItems:"center"}}>
            <div style={{flexShrink:0}}><DonutChart deepHours={tD} quickHours={tQ} learnHours={tL} size={195} viewMode={viewMode}/></div>
            <div style={{flex:1,display:"flex",flexDirection:"column",gap:8}}>
              {[{label:"Deep Work",emoji:"üèîÔ∏è",val:tD,pct:dPct,color:C.deepWork,bg:C.deepWorkLight,bc:C.deepWorkBorder},{label:"Quick Wins",emoji:"‚ö°",val:tQ,pct:qPct,color:C.quickWin,bg:C.quickWinLight,bc:C.quickWinBorder},{label:"Learn",emoji:"üìö",val:tL,pct:lPct,color:C.learn,bg:C.learnLight,bc:C.learnBorder}].map(function(cat){return(
                <div key={cat.label} style={{display:"flex",alignItems:"center",gap:8,padding:"8px 12px",borderRadius:10,background:cat.bg,border:"1px solid "+cat.bc}}>
                  <span style={{fontSize:16,flexShrink:0}}>{cat.emoji}</span>
                  <div style={{flex:1,minWidth:0}}>
                    <div style={{display:"flex",justifyContent:"space-between",alignItems:"baseline",marginBottom:3}}><span style={{fontSize:13,fontWeight:700,color:cat.color}}>{cat.label}</span><span style={{fontSize:16,fontWeight:900,color:cat.color}}>{cat.val.toFixed(1)}—á <span style={{fontSize:11,fontWeight:500,color:C.textMuted}}>({cat.pct}%)</span></span></div>
                    <div style={{width:"100%",height:8,backgroundColor:"rgba(255,255,255,.7)",borderRadius:4,overflow:"hidden"}}><div style={{width:Math.max(Math.min(cat.pct,100),cat.val>0?3:0)+"%",height:"100%",borderRadius:4,background:"linear-gradient(90deg,"+cat.color+","+cat.color+"BB)",transition:"width .8s ease"}}/></div>
                  </div>
                </div>
              )})}
            </div>
          </div>
        </div>
        <BoxBreathing/>
      </div>

      {/* PHASE PROGRESS + TAB BAR in one row */}
      <div style={{display:"flex",gap:10,marginBottom:10,flexShrink:0,alignItems:"center"}}>
        <div style={{flex:1,background:C.bgCard,borderRadius:12,padding:"8px 14px",border:"1px solid "+C.border}}>
          <div style={{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:5}}>
            <div style={{fontSize:10,color:C.textMuted,textTransform:"uppercase",letterSpacing:1.5}}>üìç –ü—Ä–æ–≥—Ä–µ—Å</div>
            <div style={{fontSize:11,fontWeight:700,color:C.textPrimary}}>Phase {state.currentPhase}: <span style={{color:C.accent}}>{PHASES[state.currentPhase]&&PHASES[state.currentPhase].name}</span></div>
          </div>
          <div style={{position:"relative",height:18,background:"#F0F4FF",borderRadius:9,border:"1px solid #D8E2F0",overflow:"visible",marginBottom:5}}>
            <div style={{height:"100%",borderRadius:9,background:state.phasesCompleted.length>0?"linear-gradient(90deg,#3A7BD5,#4A90D9,#6BA8E8)":"transparent",width:(state.phasesCompleted.length/PHASES.length)*100+"%",transition:"width 1.2s cubic-bezier(.34,1.56,.64,1)"}}/>
            {PHASES.map(function(p,i){var mP=((i+.5)/PHASES.length)*100;var done=state.phasesCompleted.indexOf(i)>=0;var cur=state.currentPhase===i;return(<div key={i} style={{position:"absolute",top:"50%",left:mP+"%",transform:"translate(-50%,-50%)",zIndex:2}}>{done?<div style={{fontSize:16,lineHeight:1,filter:"drop-shadow(0 1px 2px rgba(0,0,0,.2))"}}>üèÖ</div>:cur?<div style={{width:10,height:10,borderRadius:"50%",background:C.accent,border:"2px solid #fff",animation:"pulse 1.5s infinite"}}/>:<div style={{width:6,height:6,borderRadius:"50%",background:"#D8E2F0",border:"1px solid #C0D0E0"}}/>}</div>)})}
          </div>
          <div style={{display:"grid",gridTemplateColumns:"repeat(8,1fr)",gap:3}}>
            {PHASES.map(function(p){var done=state.phasesCompleted.indexOf(p.id)>=0;var cur=state.currentPhase===p.id;return(<button key={p.id} onClick={function(){handlePhaseComplete(p.id)}} style={{padding:"4px 2px",borderRadius:8,border:done?"2px solid "+C.quickWin:cur?"2px solid "+C.accent:"1px solid "+C.border,background:done?C.quickWin:cur?C.deepWorkLight:"#FAFAFA",cursor:"pointer",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:1,minHeight:32}}>{done?<svg width="12" height="12" viewBox="0 0 16 16" fill="none"><path d="M3 8.5L6.5 12L13 4" stroke="#fff" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"/></svg>:cur?<div style={{width:8,height:8,borderRadius:"50%",background:C.accent,animation:"pulse 1.5s infinite"}}/>:<span style={{color:"#CCC",fontWeight:700,fontSize:9}}>{p.id}</span>}<span style={{fontSize:6,fontWeight:600,color:done?"#fff":cur?C.accent:"#BBB"}}>{p.name}</span></button>)})}
          </div>
        </div>
        <div style={{display:"flex",flexDirection:"column",gap:3,background:"#F5EFEA",borderRadius:10,padding:3}}>
          {TABS.map(function(t){return <button key={t.id} onClick={function(){setTab(t.id)}} style={{padding:"8px 14px",borderRadius:8,border:"none",background:tab===t.id?C.bgCard:"transparent",color:tab===t.id?C.textPrimary:C.textMuted,fontSize:12,fontWeight:tab===t.id?700:500,cursor:"pointer",boxShadow:tab===t.id?"0 1px 4px rgba(0,0,0,.06)":"none",whiteSpace:"nowrap"}}>{t.label}</button>})}
        </div>
      </div>

      {/* TAB CONTENT ‚Äî fills remaining */}
      <div style={{flex:1,minHeight:0,overflow:"auto",borderRadius:12}}>
        {tab==="charts"&&(<div style={{background:"linear-gradient(180deg,"+C.bgCard+" 0%,#FAFAF8 100%)",borderRadius:12,padding:"12px 16px",border:"1px solid "+C.border,height:"100%",display:"flex",flexDirection:"column"}}><BarChart weeklyData={weeklyBarData} dayNumber={dayNumber}/></div>)}

        {tab==="ritual"&&(<div style={{background:ciSaved?"linear-gradient(135deg,"+C.ritualLight+" 0%,#F0FFF4 100%)":"linear-gradient(135deg,"+C.bgCard+" 0%,"+C.ritualLight+" 100%)",borderRadius:12,padding:"14px 16px",border:"1px solid "+(ciSaved?C.quickWin+"44":C.ritualBorder)}}>
          <div style={{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:12}}>
            <div style={{display:"flex",alignItems:"center",gap:8}}><span style={{fontSize:22}}>{ciSaved?"‚úÖ":"üîÆ"}</span><div><div style={{fontSize:16,fontWeight:800,color:ciSaved?C.quickWin:C.ritual}}>{ciSaved?"–°–µ–¥–º–∏—Ü–∞—Ç–∞ –µ –∑–∞—Ç–≤–æ—Ä–µ–Ω–∞!":"–°–µ–¥–º–∏—á–µ–Ω Check-in"}</div><div style={{fontSize:12,color:C.textMuted}}>{formatDate(weekStart)} ‚Äî {formatDate(weekEnd)}{ciSaved?" ¬∑ C.A.L.M. ‚úì":""}</div></div></div>
            <div style={{display:"flex",alignItems:"center",gap:5}}><button onClick={function(){navigateWeek(-1)}} style={{width:28,height:28,borderRadius:8,border:"1px solid "+C.border,background:"#fff",cursor:"pointer",fontSize:13,display:"flex",alignItems:"center",justifyContent:"center"}}>‚Äπ</button>{!isCurrentWeek&&<button onClick={function(){setCurrentWeek(new Date())}} style={{padding:"4px 10px",borderRadius:8,border:"1px solid "+C.border,background:"#fff",cursor:"pointer",fontSize:11}}>–¢–∞–∑–∏</button>}<button onClick={function(){navigateWeek(1)}} style={{width:28,height:28,borderRadius:8,border:"1px solid "+C.border,background:"#fff",cursor:"pointer",fontSize:13,display:"flex",alignItems:"center",justifyContent:"center"}}>‚Ä∫</button></div>
          </div>
          {!ciSaved&&<div style={{fontSize:12,color:C.textSecondary,marginBottom:12,padding:"8px 12px",borderRadius:10,background:"rgba(108,92,231,.05)",border:"1px solid rgba(108,92,231,.1)"}}>–û—Ç–≤–æ—Ä–∏ Notion ‚Üí –≤–∏–∂ –∫–æ–ª–∫–æ –∑–∞–¥–∞—á–∏ –æ—Ç –≤—Å—è–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—è —Å–∞ Done ‚Üí –≤—ä–≤–µ–¥–∏ –±—Ä–æ–π–∫–∏—Ç–µ —Ç—É–∫.</div>}
          <div style={{display:"flex",gap:12,marginBottom:12,opacity:ciSaved?.6:1,pointerEvents:ciSaved?"none":"auto"}}>
            <Stepper value={ciDeep} onChange={setCiDeep} color={C.deepWork} bg={C.deepWorkLight} bc={C.deepWorkBorder} emoji="üèîÔ∏è" label="Deep Work" hpe={HOURS_PER.deep}/>
            <Stepper value={ciQuick} onChange={setCiQuick} color={C.quickWin} bg={C.quickWinLight} bc={C.quickWinBorder} emoji="‚ö°" label="Quick Wins" hpe={HOURS_PER.quick}/>
            <Stepper value={ciLearn} onChange={setCiLearn} color={C.learn} bg={C.learnLight} bc={C.learnBorder} emoji="üìö" label="Learn" hpe={HOURS_PER.learn}/>
          </div>
          {!ciSaved?(<div style={{display:"flex",alignItems:"center",gap:10}}>
            <div style={{flex:1,display:"flex",alignItems:"center",gap:14,padding:"10px 14px",borderRadius:12,background:previewTasks>0?"rgba(108,92,231,.06)":"#F8F8F8",border:"1px solid "+(previewTasks>0?C.ritualBorder:C.border)}}>
              <div><div style={{fontSize:11,color:C.textMuted}}>–ó–∞–¥–∞—á–∏</div><div style={{fontSize:22,fontWeight:900,color:previewTasks>0?C.textPrimary:"#CCC"}}>{previewTasks}</div></div>
              <div style={{width:1,height:30,background:C.border}}/>
              <div><div style={{fontSize:11,color:C.textMuted}}>–ß–∞—Å–æ–≤–µ</div><div style={{fontSize:22,fontWeight:900,color:previewTasks>0?C.ritual:"#CCC"}}>{previewTotal.toFixed(1)}—á</div></div>
            </div>
            <button onClick={handleSave} disabled={previewTasks===0} style={{padding:"14px 24px",borderRadius:14,border:"none",background:previewTasks>0?"linear-gradient(135deg,"+C.ritual+",#8B5CF6)":"#E0E0E0",color:previewTasks>0?"#fff":"#999",fontSize:14,fontWeight:800,cursor:previewTasks>0?"pointer":"default",whiteSpace:"nowrap"}}>üöÄ –ó–∞—Ç–≤–æ—Ä–∏ —Å–µ–¥–º–∏—Ü–∞—Ç–∞</button>
          </div>):(<div style={{display:"flex",alignItems:"center",justifyContent:"space-between"}}>
            <div style={{display:"flex",alignItems:"center",gap:14}}>
              <div><div style={{fontSize:11,color:C.textMuted}}>–ó–∞–¥–∞—á–∏</div><div style={{fontSize:22,fontWeight:900}}>{previewTasks}</div></div>
              <div style={{width:1,height:30,background:C.border}}/>
              <div><div style={{fontSize:11,color:C.textMuted}}>–ß–∞—Å–æ–≤–µ</div><div style={{fontSize:22,fontWeight:900,color:C.ritual}}>{previewTotal.toFixed(1)}—á</div></div>
            </div>
            <button onClick={handleUndo} style={{padding:"8px 16px",borderRadius:10,border:"1px solid "+C.border,background:"#fff",fontSize:12,color:C.textMuted,cursor:"pointer",fontWeight:600}}>‚Ü© –†–µ–¥–∞–∫—Ç–∏—Ä–∞–π</button>
          </div>)}
        </div>)}

        {tab==="revenue"&&(<div style={{background:C.bgCard,borderRadius:12,padding:"10px 14px",border:"1px solid "+C.border}}>
          <div style={{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:8}}>
            <div style={{display:"flex",alignItems:"center",gap:6}}><span style={{fontSize:22}}>üí∞</span><span style={{fontSize:15,fontWeight:800,color:C.textPrimary,textTransform:"uppercase",letterSpacing:1}}>North Star</span></div>
            <div style={{fontSize:26,fontWeight:900,color:C.gold}}>‚Ç¨{state.revenue.toLocaleString()}<span style={{fontSize:14,color:C.textMuted,fontWeight:500}}> / ‚Ç¨5K</span></div>
          </div>
          <div style={{marginBottom:8}}>
            <div style={{position:"relative",height:28,background:"#FFF8E7",borderRadius:14,border:"1px solid #EDE0C0",overflow:"visible"}}>
              <div style={{height:"100%",borderRadius:14,background:"linear-gradient(90deg,#C89520,#D4A017,#E8C547)",width:Math.min(100,state.revenue/state.revenueGoal*100)+"%",transition:"width 1.2s cubic-bezier(.34,1.56,.64,1)",display:"flex",alignItems:"center",justifyContent:"flex-end",paddingRight:state.revenue/state.revenueGoal*100>10?8:0}}>{state.revenue/state.revenueGoal*100>15&&<span style={{fontSize:12,fontWeight:800,color:"#fff"}}>‚Ç¨{state.revenue.toLocaleString()}</span>}</div>
              {REVENUE_MILESTONES.map(function(m){var mP=m/5000*100;var r=state.revenue>=m;return(<div key={m} style={{position:"absolute",top:"50%",left:mP+"%",transform:"translate(-50%,-50%)",width:r?18:9,height:r?18:9,borderRadius:"50%",background:r?"#fff":"#EDE0C0",border:r?"2px solid #D4A017":"1.5px solid #DDD0B8",zIndex:2,display:"flex",alignItems:"center",justifyContent:"center"}}>{r&&<span style={{fontSize:8,color:"#D4A017"}}>‚ú¶</span>}</div>)})}
            </div>
            <div style={{position:"relative",height:18,marginTop:2}}><span style={{position:"absolute",left:0,fontSize:10,color:"#CCC"}}>‚Ç¨0</span>{REVENUE_MILESTONES.map(function(m){var mP=m/5000*100;var r=state.revenue>=m;return(<span key={m} style={{position:"absolute",left:mP+"%",transform:"translateX(-50%)",fontSize:10,color:r?"#D4A017":"#CCC",fontWeight:r?700:400}}>‚Ç¨{m/1000}K</span>)})}</div>
          </div>
          <div style={{display:"flex",gap:6,marginBottom:8}}>{[10,50,100,500].map(function(amt){return <button key={amt} onClick={function(){addRevenue(amt)}} style={{flex:1,padding:"10px 0",borderRadius:10,border:"1px solid #EDE0C0",background:C.goldLight,fontSize:14,cursor:"pointer",color:"#7A6210",fontWeight:800}}>+‚Ç¨{amt}</button>})}</div>
          <div style={{display:"flex",gap:6,marginBottom:8}}>
            <input type="number" step="10" min="0" value={revenueInput} onChange={function(e){setRevenueInput(e.target.value)}} placeholder="–°—É–º–∞ –≤ ‚Ç¨" onKeyDown={function(e){if(e.key==="Enter")handleRevenue()}} style={{flex:1,padding:"8px 12px",borderRadius:10,border:"1px solid "+C.border,fontSize:14,outline:"none",background:"#FAFAFA"}}/>
            <button onClick={handleRevenue} style={{padding:"8px 18px",borderRadius:10,border:"none",background:"linear-gradient(135deg,"+C.gold+",#E8C547)",color:"#fff",fontWeight:800,cursor:"pointer",fontSize:14,whiteSpace:"nowrap"}}>üí∞ –î–æ–±–∞–≤–∏</button>
          </div>
          <div style={{display:"flex",gap:4,marginBottom:8,alignItems:"center"}}><span style={{fontSize:11,color:C.textMuted}}>–ö–æ—Ä–µ–∫—Ü–∏—è:</span>{[10,50,100,500].map(function(amt){return <button key={amt} onClick={function(){var ns=Object.assign({},state,{revenue:Math.max(0,state.revenue-amt)});setState(ns);save(ns)}} style={{padding:"5px 10px",borderRadius:7,border:"1px solid #F0E6DE",background:"#FAFAFA",fontSize:11,cursor:"pointer",color:"#999",fontWeight:600}}>‚àí‚Ç¨{amt}</button>})}</div>
          <div style={{paddingTop:8,borderTop:"1px solid "+C.border}}>
            <div style={{fontSize:11,color:C.textMuted,marginBottom:6,textTransform:"uppercase",letterSpacing:1,fontWeight:600}}>üéÅ –ù–∞–≥—Ä–∞–¥–∏ –ø—Ä–∏ milestone</div>
            <div style={{display:"flex",gap:4}}>
              {[{at:100,emoji:"üçΩÔ∏è",label:"–í–µ—á–µ—Ä—è"},{at:500,emoji:"üéß",label:"–°–ª—É—à–∞–ª–∫–∏"},{at:1000,emoji:"üèñÔ∏è",label:"–£–∏–∫–µ–Ω–¥"},{at:1500,emoji:"üì±",label:"–¢–µ–ª–µ—Ñ–æ–Ω"},{at:2000,emoji:"üíª",label:"–õ–∞–ø—Ç–æ–ø"},{at:2500,emoji:"‚úàÔ∏è",label:"–ü—ä—Ç—É–≤–∞–Ω–µ"},{at:3000,emoji:"üöó",label:"–ö–æ–ª–∞"},{at:3500,emoji:"üè°",label:"–†–µ–º–æ–Ω—Ç"},{at:4000,emoji:"üß†",label:"Mastermind"},{at:5000,emoji:"üèÜ",label:"–°–í–û–ë–û–î–ê"}].map(function(r){var u=state.revenue>=r.at;return(<div key={r.at} style={{flex:1,display:"flex",flexDirection:"column",alignItems:"center",gap:1,padding:"4px 1px",borderRadius:8,background:u?C.goldLight:"#FAFAFA",border:"1px solid "+(u?C.gold+"33":C.border)}}>
                <div style={{fontSize:18,filter:u?"none":"grayscale(1) opacity(.25)"}}>{r.emoji}</div>
                <div style={{fontSize:7,fontWeight:u?700:500,color:u?C.gold:"#BBB",textAlign:"center",lineHeight:1.1}}>{r.label}</div>
              </div>)})}
            </div>
          </div>
        </div>)}
      </div>
    </div>
  );
}

ReactDOM.render(React.createElement(CALMDashboard), document.getElementById('root'));
</script>
</body>
</html>
